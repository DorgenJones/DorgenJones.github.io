<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.0.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.0.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.0.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.0.3">


  <link rel="mask-icon" href="/images/logo.svg?v=6.0.3" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.0.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  
  <meta name="keywords" content="Hexo, NexT" />


<meta property="og:type" content="website">
<meta property="og:title" content="Zamperini">
<meta property="og:url" content="https://dorgenjones.github.io/page/6/index.html">
<meta property="og:site_name" content="Zamperini">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Zamperini">
<meta name="twitter:card" content="summary">






  <link rel="canonical" href="https://dorgenjones.github.io/page/6/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>
  <title>Zamperini</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Zamperini</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-home"></i> <br />é¦–é¡µ</a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-user"></i> <br />å…³äº</a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />æ ‡ç­¾</a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-th"></i> <br />åˆ†ç±»</a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />å½’æ¡£</a>
        </li>
      

      
    </ul>
  

  
</nav>


  



 </div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dorgenjones.github.io/2017/08/12/%E5%9F%BA%E7%A1%80%E5%B7%A5%E5%85%B7/hystrix/1.hystrix-%E7%AE%80%E4%BB%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zamperini">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zamperini">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/12/%E5%9F%BA%E7%A1%80%E5%B7%A5%E5%85%B7/hystrix/1.hystrix-%E7%AE%80%E4%BB%8B/" itemprop="url">Hystrix-ç®€ä»‹</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-08-12T00:00:00+08:00">2017-08-12</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/hystrix/" itemprop="url" rel="index"><span itemprop="name">hystrix</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#Hystrix ç®€ä»‹<br>â€œ<strong>Excuse me? å¤´æˆ´é‡‘å†  åŒ—æç†Š??</strong>â€œ<br><img src="/media/15018147277400.jpg" alt="set up-w300"></p>
<blockquote>
<p>Netflix(ä¸–ç•Œæœ€å¤§åœ¨çº¿å½±ç‰‡ç§ŸèµæœåŠ¡å•†)å¼€æºçš„å»¶è¿Ÿå®¹é”™å·¥å…·åŒ…ï¼Œç”¨äºéš”ç¦»åˆ†å¸ƒå¼ç³»ç»Ÿä¹‹é—´çš„ä¾èµ–è®¿é—®ã€‚é˜²æ­¢çº§è”æ•…éšœï¼Œä½¿å¾—å¤æ‚çš„åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é”™è¯¯ä¸å¯é¿å…çš„æ¡ä»¶ä¸‹ä»å…·æœ‰å¼¹æ€§ï¼Œå…·æœ‰è‡ªæˆ‘ä¿æŠ¤çš„èƒ½åŠ›ã€‚</p>
</blockquote>
<p><a href="https://github.com/Netflix/Hystrix/wiki/FAQ%20:%20General#where-does-the-name-come-from" target="_blank" rel="noopener"><strong>Where does the name from?</strong></a></p>
<p><img src="/media/14980602061637.jpg" alt="set up-w300"></p>
<h2 id="åŠŸèƒ½ï¼š"><a href="#åŠŸèƒ½ï¼š" class="headerlink" title="åŠŸèƒ½ï¼š"></a>åŠŸèƒ½ï¼š</h2><ul>
<li>é˜²æŠ¤å¹¶æ§åˆ¶å› ä¾èµ–ç¬¬ä¸‰æ–¹æœåŠ¡å¯¼è‡´çš„å»¶æ—¶å’Œæ•…éšœï¼›</li>
<li>é˜»æ­¢çº§è”æ•…éšœï¼›</li>
<li>å¿«é€Ÿå¤±è´¥å¹¶ä¸”èƒ½å¿«é€Ÿæ¢å¤ï¼›</li>
<li>æ”¯æŒå¤±è´¥é™çº§å’Œæä¾›ä¼˜é›…çš„æœåŠ¡é™çº§æœºåˆ¶ï¼›</li>
<li>æ”¯æŒè¿‘å®æ—¶ç›‘æ§ã€æŠ¥è­¦ä»¥åŠæ“ä½œæ§åˆ¶ã€‚</li>
</ul>
<h2 id="åº”ç”¨åœºæ™¯ï¼š"><a href="#åº”ç”¨åœºæ™¯ï¼š" class="headerlink" title="åº”ç”¨åœºæ™¯ï¼š"></a>åº”ç”¨åœºæ™¯ï¼š</h2><p>åœ¨å¤æ‚çš„åˆ†å¸ƒå¼ç³»ç»Ÿé‡Œä¼šæœ‰å¾ˆå¤šä¾èµ–ï¼Œæ¯ä¸ªä¾èµ–éƒ½ä¼šä¸å¯é¿å…åœ°åœ¨æŸäº›æ—¶å€™å‘ç”Ÿæ•…éšœã€‚å¦‚æœä¸»åº”ç”¨æ²¡æœ‰éš”ç¦»è¿™äº›æ•…éšœï¼Œé‚£ä¹ˆå°±æœ‰è¢«æ‹–å®çš„é£é™©ã€‚(<em>mmdb</em>å¤§é¢ç§¯è¶…æ—¶å°±æ˜¯æœ€æœ‰è¯´æœåŠ›çš„ğŸŒ°)<br>Hystrixå®˜ç½‘ç»™å‡ºäº†è¿™æ ·ä¸€ä¸ªä¾‹å­ï¼š</p>
<blockquote>
<p>ä¸€ä¸ªåº”ç”¨ä¾èµ–30ä¸ªå¤–éƒ¨æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡çš„å¯ç”¨æ€§ä¸º<code>99.99%</code>ï¼Œé‚£ä¹ˆä¸»åº”ç”¨çš„å¯ç”¨æ€§å³ä¸º<code>99.99^30</code> = <code>99.7%</code><br><code>0.3%</code>çš„æ•…éšœç‡æ„å‘³ç€æ¯æœˆæœ‰2+å°æ—¶çš„æ—¶é—´æœåŠ¡ä¸å¯ç”¨ã€‚å¯ç”¨æ€§æ˜¯ç›¸å½“å·®çš„<br>å½“æœåŠ¡ä¾èµ–æ•°è¶Šå¤šæ—¶ï¼Œæ•´ä½“å¯ç”¨æ€§è¶Šå·®</p>
</blockquote>
<p>æœåŠ¡æ­£å¸¸è¿è¡Œæ—¶ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:<br><img src="/media/14980612634741.jpg" alt=""></p>
<p>å½“æœ‰ä¸€ä¸ªåå°ç³»ç»Ÿå»¶æ—¶è¾ƒé«˜æ—¶ï¼Œä¼šé˜»å¡æ•´ä¸ªç”¨æˆ·çš„è¯·æ±‚ï¼š</p>
<p><img src="/media/14980612716095.jpg" alt=""><br>åœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œå•ä¸ªåå°ä¾èµ–æ¥å£è¶…æ—¶åä¼šé€ æˆæ‰€æœ‰æœåŠ¡å™¨ä¸Šçš„èµ„æºéƒ½è¢«è€—å°½ï¼Œé€ æˆæ›´å¤šçº§è”æ•…éšœã€‚</p>
<p><img src="/media/14980612832009.jpg" alt=""></p>
<p>å› æ­¤ï¼Œæ‰€æœ‰è¿™äº›å»¶æ—¶å’Œæ•…éšœéƒ½åº”è¯¥è¢«éš”ç¦»å’Œç®¡ç†ï¼Œä½¿å¾—å•ä¸ªæ¥å£æ•…éšœä¸ä¼šæ‹–ç´¯æ•´ä¸ªåº”ç”¨ã€‚</p>
<h2 id="è®¾è®¡åŸåˆ™"><a href="#è®¾è®¡åŸåˆ™" class="headerlink" title="è®¾è®¡åŸåˆ™"></a>è®¾è®¡åŸåˆ™</h2><ul>
<li>é€šè¿‡<strong>çº¿ç¨‹éš”ç¦»</strong>æ¥é˜²æ­¢å•ä¸ªä¾èµ–è€—å°½æ‰€æœ‰çš„å®¹å™¨å†…æ‰€æœ‰ç”¨æˆ·çº¿ç¨‹ï¼›</li>
<li>åœ¨ç³»ç»Ÿæ— æ³•åŠæ—¶å¤„ç†è¯·æ±‚æ—¶<strong>å¿«é€Ÿå¤±è´¥</strong>ï¼Œè€Œä¸æ˜¯å…¥é˜Ÿï¼Œä»¥é™ä½ç³»ç»Ÿè´Ÿè½½ï¼›</li>
<li>æä¾›<strong>å¤±è´¥é™çº§</strong>ï¼Œåœ¨å¿…è¦çš„æ—¶å€™è®©å¤±æ•ˆå¯¹ç”¨æˆ·é€æ˜ã€‚</li>
<li>åˆ©ç”¨éš”ç¦»æœ¯ï¼ˆèˆ±å£ã€æ³³é“ã€ç†”æ–­å™¨æ¨¡å¼ï¼‰æ¥éš”ç¦»å•ä¸ªä¾èµ–å¯¹æ•´ä¸ªç³»ç»Ÿçš„å½±å“ï¼›</li>
<li>é’ˆå¯¹ç³»ç»ŸæœåŠ¡çš„åº¦é‡ã€ç›‘æ§ã€æŠ¥è­¦ï¼Œæä¾›ä¼˜åŒ–ä»¥æ»¡è¶³è¿‘å®æ—¶æ€§çš„éœ€æ±‚ï¼›</li>
<li>Hystrixçš„å¤§éƒ¨åˆ†å±æ€§éƒ½æ”¯æŒ<strong>åŠ¨æ€é…ç½®</strong>å¹¶ä¸”å¿«é€Ÿåº”ç”¨ï¼Œä»è€Œå¯ä»¥è¾…åŠ©æˆ‘ä»¬åšå®æ—¶çš„æ“ä½œä¿®æ”¹ï¼›</li>
<li>å¯ä»¥<strong>éš”ç¦»</strong>åº”ç”¨æ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹ä¸­å¤±è´¥çš„å½±å“ï¼Œè€Œä¸ä»…ä»…åœ¨ç½‘ç»œé€šä¿¡ä¸­ã€‚</li>
</ul>
<h2 id="å®ç°åŸç†"><a href="#å®ç°åŸç†" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h2><ul>
<li>å°†æ‰€æœ‰å¯¹å¤–éƒ¨ç³»ç»Ÿçš„è°ƒç”¨éƒ½<strong>åŒ…è£…</strong>åœ¨å‘½ä»¤æ¨¡å¼çš„å¯¹è±¡ <code>HystrixCommand</code> or <code>HystrixObservableCommand</code>ä¸­ï¼Œå®ƒé€šè¿‡åœ¨ä¸€ä¸ªéš”ç¦»çš„çº¿ç¨‹ä¸­æ‰§è¡Œè¿œç¨‹è°ƒç”¨ã€‚</li>
<li>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ”¯æŒ<strong>è‡ªåŠ¨è¶…æ—¶æœºåˆ¶</strong>ï¼Œä¹Ÿæ”¯æŒäººå·¥é…ç½®è¶…æ—¶æ—¶é—´ï¼ˆ995çº¿ï¼‰ã€‚</li>
<li>å¯¹äºæ¯ä¸ªä¾èµ–éƒ½ç»´æŒä¸€ä¸ª<strong>çº¿ç¨‹æ± </strong>ï¼Œå¦‚æœçº¿ç¨‹æ± å˜æ»¡äº†ï¼Œåˆ™ç«‹å³æ‹’ç»è€Œä¸æ˜¯æ’é˜Ÿã€‚</li>
<li><strong>è®°å½•æˆåŠŸã€å¤±è´¥ã€è¶…æ—¶å’Œè¢«çº¿ç¨‹æ‹’ç»çš„è¯·æ±‚æ•°</strong>ã€‚</li>
<li>å¼•å…¥<strong>æ–­è·¯å™¨æœºåˆ¶</strong>ä»¥é˜»æ–­ä¸€æ®µæ—¶é—´å†…å¯¹ç‰¹å®šæœåŠ¡çš„è®¿é—®ã€‚æ”¯æŒæ‰‹åŠ¨å¼€å¯æ–­è·¯å™¨ï¼Œæˆ–è€…æ ¹æ®å¤±è´¥ç‡è‡ªåŠ¨å¼€å¯æ¨¡å¼ã€‚</li>
<li>åœ¨è¯·æ±‚å¤±è´¥ã€è¶…æ—¶ã€æ‹’ç»æ—¶ï¼Œå¯ä»¥æ‰§è¡Œé™çº§é€»è¾‘ã€‚</li>
<li>ç›‘æ§è®¡é‡æ•°æ®å’Œé…ç½®ä¿®æ”¹ä¿¡æ¯å¹¶æ”¯æŒè¿‘å®æ—¶åœ°ä¿®æ”¹é…ç½®ã€‚</li>
</ul>
<p>å½“ä½¿ç”¨Hystrixæ¥åŒ…è£…æ¯ä¸ªä¾èµ–æœåŠ¡æ—¶ï¼Œä¸Šé¢çš„æ¶æ„å³å˜ä¸ºå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å…¶ä¸­æ¯ä¸ªä¾èµ–éƒ½ç›¸äº’éš”ç¦»ï¼Œå½“å»¶è¿Ÿå‘ç”Ÿæ—¶åªä¼šè€—å°½å…¶å†…éƒ¨èµ„æºè€Œä¸å½±å“å…¶ä»–èµ„æºï¼ŒåŒæ—¶ä¹Ÿè¦†ç›–äº†é™çº§é€»è¾‘ç”¨äºä¾èµ–æœåŠ¡å‘ç”Ÿé”™è¯¯æ—¶å‘ç”¨æˆ·è¿”å›ä¿¡æ¯ã€‚</p>
<p><img src="/media/14980613555431.jpg" alt=""></p>
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://github.com/Netflix/Hystrix/wiki" target="_blank" rel="noopener">Hystrix</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dorgenjones.github.io/2017/03/14/%E5%9F%BA%E7%A1%80%E5%B7%A5%E5%85%B7/log/4.log4j2%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%A4%84%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zamperini">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zamperini">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/14/%E5%9F%BA%E7%A1%80%E5%B7%A5%E5%85%B7/log/4.log4j2%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%A4%84%E7%90%86/" itemprop="url">Log4j2 æ ¼å¼åŒ–å¤„ç†</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-03-14T00:00:00+08:00">2017-03-14</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/log4j/" itemprop="url" rel="index"><span itemprop="name">log4j</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="PatternFormatter"><a href="#PatternFormatter" class="headerlink" title="PatternFormatter"></a>PatternFormatter</h1><h2 id="LogEventPatternConverter"><a href="#LogEventPatternConverter" class="headerlink" title="LogEventPatternConverter"></a>LogEventPatternConverter</h2><pre><code>### - LevelPatternConverter
### - ThreadPatternConvter
### - DatePatternConverter</code></pre><h2 id="FormattingInfo"><a href="#FormattingInfo" class="headerlink" title="FormattingInfo"></a>FormattingInfo</h2><h1 id="PatternLayout"><a href="#PatternLayout" class="headerlink" title="PatternLayout"></a>PatternLayout</h1><blockquote>
<p>åœ¨å¯¹PatternLayoutçš„patternå­—æ®µè¿›è¡Œè§£æï¼ˆPatternParserçš„parse(final String pattern, final boolean alwaysWriteExceptions,final boolean noConsoleNoAnsi)ä¸­è¿›è¡Œï¼‰æ—¶ï¼Œä¼šç”Ÿæˆ List<PatternFormatter> formatters<br>PatternFormatter(LogEventPatternConverter,FormattingInfo) å…¶ä¸­LogEventPatternConverterç”¨æ¥å°†æ—¥å¿—äº‹ä»¶LogEventè½¬æ¢ä¸ºæŒ‡å®šæ ¼å¼çš„å­—ç¬¦ä¸²å¹¶è¿½åŠ åˆ°è¾“å‡ºå­—ç¬¦ä¸²åã€‚</p>
</blockquote>
<h2 id="æ’ä»¶çš„åˆå§‹åŒ–å…¥å£åœ¨"><a href="#æ’ä»¶çš„åˆå§‹åŒ–å…¥å£åœ¨" class="headerlink" title="æ’ä»¶çš„åˆå§‹åŒ–å…¥å£åœ¨:"></a>æ’ä»¶çš„åˆå§‹åŒ–å…¥å£åœ¨:</h2><blockquote>
<p>PluginManager.collectPluginsé‡Œï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªPluginRegistryå•ä¾‹ï¼Œå…¶<code>decodeCacheFiles</code>æ–¹æ³•ç”¨äºä»META-INF/org/apache/logging/log4j/core/config/plugins/Log4j2Plugins.datæ–‡ä»¶ä¸­åŠ è½½å¹¶è§£ææ’ä»¶å¯¹è±¡ï¼Œå¹¶æŒ‰ç±»åˆ«å­˜å‚¨ã€‚ç›®å‰å…±æœ‰6ä¸­ç±»å‹æ’ä»¶ï¼šconverter,lookup,core,configurationfactory,fileconverter,typeconverter</p>
</blockquote>
<h2 id="PatternLayoutçš„å¤„ç†"><a href="#PatternLayoutçš„å¤„ç†" class="headerlink" title="PatternLayoutçš„å¤„ç†:"></a>PatternLayoutçš„å¤„ç†:</h2><blockquote>
<p>åœ¨å®ä¾‹åŒ–PatternFormatteræ—¶ï¼ŒåŒæ—¶ä¼šé€šè¿‡PatternParserå°† å­—ç¬¦ä¸²è½¬æ¢æˆè½¬æ¢å™¨åˆ—è¡¨<code>PatternFormater(LogEventPatternConverter,FormattingInfo)</code>ã€‚LogEventPatternConverteræ˜¯è½¬æ¢ç±»æ’ä»¶çš„æŠ½è±¡ç±»ã€‚<br>ä¸‹å›¾æ¼”ç¤ºçš„å°±æ˜¯å…¶å¯¹åº”å…³ç³»ï¼š<br><img src="/media/14933065402517.jpg" alt="set up-w888"></p>
</blockquote>
<!--
**ä¿®æ”¹ï¼š**
- 1.é¦–å…ˆï¼Œå¯»æ‰¾org.apache.commons.logging.LogFactory å±æ€§é…ç½®ã€‚
- å¦åˆ™ï¼Œåˆ©ç”¨JDK1.3 å¼€å§‹æä¾›çš„service å‘ç°æœºåˆ¶ï¼Œä¼šæ‰«æclasspah ä¸‹çš„META-INF/services/org.apache.commons.logging.LogFactoryæ–‡ä»¶ï¼Œè‹¥æ‰¾åˆ°åˆ™è£…è½½é‡Œé¢çš„é…ç½®ï¼Œä½¿ç”¨é‡Œé¢çš„é…ç½®ã€‚
- å¦åˆ™ï¼Œä»Classpath é‡Œå¯»æ‰¾commons-logging.properties ï¼Œæ‰¾åˆ°åˆ™æ ¹æ®é‡Œé¢çš„é…ç½®åŠ è½½ã€‚
- å¦åˆ™ï¼Œä½¿ç”¨é»˜è®¤çš„é…ç½®ï¼šå¦‚æœèƒ½æ‰¾åˆ°Log4j åˆ™é»˜è®¤ä½¿ç”¨log4j å®ç°ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨JDK14Logger å®ç°ï¼Œå†æ²¡æœ‰åˆ™ä½¿ç”¨commons-logging å†…éƒ¨æä¾›çš„SimpleLog å®ç°ã€‚-->


<p>ä¸ªäººæ„Ÿè§‰SLF4Jçš„å®ç°æ›´åŠ çµæ´»ï¼Œå¹¶ä¸”å®ƒè¿˜æä¾›äº†Makerå’ŒMDCçš„æ¥å£</p>
<h3 id="3-SLF4J-ä¸-Common-loggingå¯¹æ¯”"><a href="#3-SLF4J-ä¸-Common-loggingå¯¹æ¯”" class="headerlink" title="3. SLF4J ä¸ Common-loggingå¯¹æ¯”"></a>3. SLF4J ä¸ Common-loggingå¯¹æ¯”</h3><ol>
<li><p>common-loggingé€šè¿‡<strong>åŠ¨æ€æŸ¥æ‰¾</strong>çš„æœºåˆ¶ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶è‡ªåŠ¨æ‰¾å‡ºçœŸæ­£ä½¿ç”¨çš„æ—¥å¿—åº“ã€‚ç”±äºå®ƒä½¿ç”¨äº†ClassLoaderå¯»æ‰¾å’Œè½½å…¥åº•å±‚çš„æ—¥å¿—åº“ï¼Œ å¯¼è‡´äº†åƒOSGIè¿™æ ·çš„æ¡†æ¶æ— æ³•æ­£å¸¸å·¥ä½œï¼Œå› ä¸ºOSGIçš„ä¸åŒçš„æ’ä»¶ä½¿ç”¨è‡ªå·±çš„ClassLoaderã€‚ OSGIçš„è¿™ç§æœºåˆ¶ä¿è¯äº†æ’ä»¶äº’ç›¸ç‹¬ç«‹ï¼Œç„¶è€Œå´ä½¿Common-loggingæ— æ³•å·¥ä½œã€‚</p>
</li>
<li><p>slf4jåœ¨ç¼–è¯‘æ—¶<strong>é™æ€ç»‘å®š</strong>çœŸæ­£çš„Logåº“,å› æ­¤å¯ä»¥åœ¨OSGIä¸­ä½¿ç”¨ã€‚å¦å¤–ï¼ŒSLF4J æ”¯æŒå‚æ•°åŒ–çš„logå­—ç¬¦ä¸²ï¼›å…¶æ¬¡å…¶é¿å…äº†ä¹‹å‰ä¸ºäº†å‡å°‘å­—ç¬¦ä¸²æ‹¼æ¥çš„æ€§èƒ½æŸè€—è€Œä¸å¾—ä¸å†™çš„if(logger.isDebugEnable())ï¼Œå¯ä»¥ç›´æ¥å†™ï¼šlogger.debug(â€œcurrent user is: {}â€, user)ã€‚æ‹¼è£…æ¶ˆæ¯è¢«æ¨è¿Ÿåˆ°äº†å®ƒèƒ½å¤Ÿç¡®å®šæ˜¯ä¸æ˜¯è¦æ˜¾ç¤ºè¿™æ¡æ¶ˆæ¯çš„æ—¶å€™ï¼Œä½†æ˜¯è·å–å‚æ•°çš„ä»£ä»·å¹¶æ²¡æœ‰å¹¸å…ã€‚</p>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dorgenjones.github.io/2017/03/13/%E5%9F%BA%E7%A1%80%E5%B7%A5%E5%85%B7/log/3.log4j2%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zamperini">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zamperini">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/13/%E5%9F%BA%E7%A1%80%E5%B7%A5%E5%85%B7/log/3.log4j2%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" itemprop="url">Log4j2æºç è§£æ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-03-13T00:00:00+08:00">2017-03-13</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/log4j/" itemprop="url" rel="index"><span itemprop="name">log4j</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Log4j2-æºç æµ…æ"><a href="#Log4j2-æºç æµ…æ" class="headerlink" title="Log4j2 æºç æµ…æ"></a>Log4j2 æºç æµ…æ</h1><p>[TOC]</p>
<p>ä»‹ç»Log4j2çš„åŸç†ä¹‹å‰ï¼Œå›é¡¾ä¸‹ä¹‹å‰é…ç½®æ–‡ä»¶ä¸­æåˆ°çš„å‡ ä¸ªæ¦‚å¿µï¼šConfigurationã€LoggerConfigã€Loggerã€Appenderã€Layoutã€Filterã€‚Log4j2çš„å®˜ç½‘ä¸Šç»™å‡ºäº†ç±»å›¾ï¼Œèƒ½æ¸…æ™°åœ°çœ‹æ¸…æ¥šå®ƒä»¬ä¹‹é—´çš„å…³è”ã€‚<br>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºLoggerContextã€Configurationæ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œåœ¨ä¸€èˆ¬çš„åº”ç”¨ä¸­é€šå¸¸ä¹Ÿéƒ½åªå­˜åœ¨ä¸€ä¸ªå®ä¾‹(Share one ClassLoader(<strong>Standalone Applicationã€Web Applicationã€Java EE Applicationsã€â€Sharedâ€ Web Applications and REST Service Containers</strong>)ï¼Œ<strong>Not</strong> <strong>OSGi Applications</strong> <a href="http://logging.apache.org/log4j/2.x/manual/logsep.html" target="_blank" rel="noopener">Logging Separation</a>)ã€‚</p>
<ol>
<li><strong>LoggerContext</strong>: æ•´ä¸ªæ—¥å¿—ç³»ç»Ÿçš„<strong>é”šç‚¹</strong>ï¼ˆæ‰¿è½½å…¨å±€æ—¥å¿—ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼‰ï¼Œç±»ä¼¼äºSpringçš„WebApplicationContext</li>
<li><strong>Configuration</strong>: <strong>å…¨å±€é…ç½®ä¿¡æ¯</strong>ï¼Œæ¯ä¸ªLoggerContextå¯¹åº”ä¸€ä¸ªConfiguration</li>
<li><strong>Appender</strong>: è¿½åŠ å™¨ï¼Œå¯¹åº”é…ç½®æ–‡ä»¶ä¸­çš„<code>&lt;Appenders&gt;</code>ä¸‹å®šä¹‰çš„Appenderï¼Œå®šä¹‰æ—¥å¿—è¾“å‡ºä½ç½®ä»¥åŠæ—¥å¿—è¾“å‡ºæ ¼å¼ï¼Œã€‚ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰Appenderï¼Œåªéœ€ç»§æ‰¿AbstractAppenderå¹¶å®ç°append(LogEvent)æ–¹æ³•ã€‚<ul>
<li><strong>Layout</strong>: å®šä¹‰æ—¥å¿—çš„è¾“å‡ºæ ¼å¼</li>
</ul>
</li>
<li><strong>Filter</strong>: <strong>è¿‡æ»¤å™¨</strong>ï¼Œåœ¨æ•´ä¸ªæ—¥å¿—ç³»ç»Ÿçš„ç±»å›¾ä¸­ï¼Œå¤šä¸ªåœ°æ–¹åº”ç”¨ã€‚èµ·åˆ°ä¸€ä¸ªè¿‡æ»¤çš„ä½œç”¨ï¼Œç”¨äºè¿‡æ»¤ç‰¹å®šæ—¥å¿—çº§åˆ«çš„æ—¥å¿—äº‹ä»¶ã€‚æœ‰å¤šä¸ªåœ°æ–¹å¼•ç”¨<code>Filter</code>ï¼šæ—¥å¿—äº‹ä»¶è¿›å…¥LoggerConfigä¹‹å‰ï¼›è¿›å…¥LoggerConfigåè°ƒç”¨ä»»ä½•Appenderä¹‹å‰ï¼›è¿›å…¥LoggerConfigåè°ƒç”¨ç‰¹æ®Šçš„Appenderä¹‹å‰ï¼›æ¯ä¸ªAppenderå†…éƒ¨ã€‚</li>
<li><strong>LoggerConfig</strong>: çœŸæ­£çš„æ—¥å¿—æ“ä½œå®ä½“ï¼Œå¯¹åº”é…ç½®æ–‡ä»¶ä¸­çš„<code>&lt;Logger&gt;</code>ä¸‹å®šä¹‰çš„Loggerã€‚å«æœ‰å…¨å±€å”¯ä¸€æ ‡è¯†ï¼ˆåç§°ï¼‰ï¼Œä¸€èˆ¬å¯¹åº”çš„æ˜¯ä¸€ä¸ªåŒ…ç›®å½•åç§°ã€‚</li>
<li><strong>Logger</strong>: å£³ï¼Œæ¯ä¸ªLoggerå†…éƒ¨éƒ½å¯¹åº”ä¸€ä¸ªLoggerConfigï¼ˆé€šè¿‡åç§°æ¥å¯¹åº”ï¼‰ã€‚å¯¹æ—¥å¿—äº‹ä»¶çš„æ“ä½œï¼Œéƒ½äº¤ç”±å…¶å¯¹åº”çš„LoggerConfigè¿›è¡Œå¤„ç†<br><img src="/media/14930134238097.jpg" alt="set up-w666"></li>
</ol>
<ul>
<li>åœ¨ä½¿ç”¨æ—¥å¿—ç³»ç»Ÿå‰ï¼Œé¦–å…ˆéœ€è¦åˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿï¼šè§£ææ—¥å¿—é…ç½®ä¿¡æ¯<code>Configuration</code>ï¼Œå»ºç«‹æ—¥å¿—ä¸Šä¸‹æ–‡<code>LoggerContext</code>ï¼ˆå±æ€§ã€Appenderã€LogerConfigâ€¦ï¼‰</li>
<li>ç»™å®šnameè·å–æ—¥å¿—å¯¹è±¡Loggeræ—¶ï¼Œ<code>LoggerContext</code>ç»“åˆä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œè¿”å›ä¸€ä¸ªç»‘å®šäº†ç‰¹å®šåç§°çš„<code>LoggerConfig</code>çš„<code>Loger</code></li>
<li>åœ¨æ‰§è¡Œæ—¥å¿—æ“ä½œæ—¶ï¼Œä¼šç»è¿‡å¤šå±‚è¿‡æ»¤(Filter)ï¼Œå¹¶ä¸”çœŸæ­£çš„æ—¥å¿—æ“ä½œç”±LoggerConfigæ¥å¤„ç†ã€‚</li>
</ul>
<p>å› æ­¤ä¸‹é¢ï¼Œå°†ä»<strong>è¿™ä¸‰æ–¹é¢</strong>æ¥åˆ†ææ—¥å¿—ç³»ç»Ÿã€‚1. æ—¥å¿—ç³»ç»Ÿçš„åˆå§‹åŒ–ï¼›2.è·å–æ—¥å¿—å¯¹è±¡ï¼›3.æ—¥å¿—æ“ä½œè¿‡ç¨‹ã€‚å…¶ä¸­ï¼Œæ—¥å¿—ç³»ç»Ÿçš„åˆå§‹åŒ–è¾ƒå…¶ä»–ä¸¤éƒ¨åˆ†ç¨å¤æ‚ã€‚</p>
<h2 id="1-æ—¥å¿—ç³»ç»Ÿçš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œè·å–LoggerContext"><a href="#1-æ—¥å¿—ç³»ç»Ÿçš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œè·å–LoggerContext" class="headerlink" title="1. æ—¥å¿—ç³»ç»Ÿçš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œè·å–LoggerContext"></a>1. æ—¥å¿—ç³»ç»Ÿçš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œè·å–LoggerContext</h2><p>åˆå§‹åŒ–çš„è¿‡ç¨‹å…³é”®æ˜¯ åŠ è½½å¹¶è§£æé…ç½®æ–‡ä»¶ï¼Œå»ºç«‹æ—¥å¿—ä¸Šä¸‹æ–‡ã€‚<br>åˆå§‹åŒ–è¿‡ç¨‹çš„æ—¶åºå›¾ï¼š<br><img src="/media/log%E5%88%9D%E5%A7%8B%E5%8C%96%E6%97%B6%E5%BA%8F%E5%9B%BE.png" alt="logåˆå§‹åŒ–æ—¶åºå›¾"></p>
<p>å½“åº”ç”¨é¦–æ¬¡è°ƒåŠ¨<code>LogManager.getLogger</code>æ–¹æ³•æ—¶ï¼Œè§¦å‘æ—¥å¿—ç³»ç»Ÿçš„åˆå§‹åŒ–ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Logger <span class="title">getLogger</span><span class="params">(<span class="keyword">final</span> Class&lt;?&gt; clazz)</span> </span>&#123;</span><br><span class="line">   ...</span><br><span class="line">   <span class="comment">//è·å–LoggerContextï¼Œé€šè¿‡å…¶è·å–æŒ‡å®šç±»åç§°çš„Logger</span></span><br><span class="line">   <span class="keyword">return</span> getContext(clazz.getClassLoader(), <span class="keyword">false</span>).getLogger(clazz.getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>getContext</code>æ–¹æ³•æ˜¯å»ºç«‹æ—¥å¿—ç³»ç»Ÿä¸Šä¸‹æ–‡çš„<strong>èµ·ç‚¹</strong>ã€‚LogManageråœ¨ç±»åˆå§‹åŒ–æ—¶ï¼Œä¼šåˆå§‹åŒ–ä¸€ä¸ªç”ŸæˆLogerContextå·¥å‚ï¼Œç”¨æˆ·å¯ä»¥æŒ‡å®šè¿™ä¸ªå·¥å‚ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸ºLog4jContextFactoryã€‚ä¸‹æ–‡æˆ‘ä»¬ä»¥Log4jContextFactoryä¸ºä¸»çº¿æ¥åˆ†æï¼Œå…¶ä»–æƒ…å†µç±»ä¼¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LoggerContext <span class="title">getContext</span><span class="params">(<span class="keyword">final</span> ClassLoader loader, <span class="keyword">final</span> <span class="keyword">boolean</span> currentContext)</span> </span>&#123;</span><br><span class="line"><span class="comment">//factoryä¸ºLoggerContextFactoryæ¥å£çš„å®ç°ç±»ï¼Œè·å–LoggerContextçš„å·¥å‚ï¼Œ</span></span><br><span class="line"><span class="comment">//è€Œfatoryçš„çœŸæ­£ç±»å‹çš„åˆå§‹åŒ–æ˜¯åœ¨LogerManagerçš„é™æ€è¯­å¥ä¸­è¿›è¡Œã€‚è¿™é‡Œæˆ‘ä»¬ä¸»è¦å…³æ³¨Log4jContextFactory</span></span><br><span class="line">   <span class="keyword">return</span> factory.getContext(FQCN, loader, <span class="keyword">null</span>, currentContext);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨åˆå§‹åŒ–Log4jContextFactoryå·¥å‚å¯¹è±¡æ—¶ï¼ŒåŒæ—¶ä¼šå®ä¾‹åŒ–ä¸€ä¸ªå®ç°<code>ContextSelector</code>ï¼ˆç”¨äºå®šä½<code>LogerContext</code>ï¼‰æ¥å£çš„æ—¥å¿—ä¸Šä¸‹æ–‡é€‰æ‹©å™¨ã€‚åŒæ ·ï¼Œç”¨æˆ·å¯ä»¥æŒ‡å®šè¿™ä¸ªé€‰æ‹©å™¨ï¼ˆå±æ€§é…ç½®ï¼š<code>Log4jContextSelector</code>ï¼‰ï¼›é»˜è®¤ä¸º<code>ClassLoaderContextSelector</code>ï¼ˆå‰é¢ä¸€èŠ‚æåˆ°çš„å…¨å¼‚æ­¥åŒ–æ˜¯å°†<code>ClassLoaderContextSelector</code>è®¾ç½®ä¸º<code>AsyncLoggerContextSelector</code>ï¼‰ã€‚ä¸‹æ–‡åŒæ ·ä»¥<code>ClassLoaderContextSelector</code>ä¸ºä¾‹ã€‚</p>
<p>è¿›ä¸€æ­¥ï¼Œ<code>Log4jContextFactory</code>ä¼šè°ƒåŠ¨<code>ClassLoaderContextSelector</code>çš„<code>getContext</code>æ–¹æ³•æ¥è·å–<code>LoggerContext</code>ï¼Œç„¶åè°ƒç”¨LoggerContextçš„startæ–¹æ³•è¿›è¡Œæ—¥å¿—ç³»ç»Ÿçš„åˆå§‹åŒ–ï¼ˆ<strong>æ ¸å¿ƒéƒ¨åˆ†</strong>ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> LoggerContext <span class="title">getContext</span><span class="params">(<span class="keyword">final</span> String fqcn, <span class="keyword">final</span> ClassLoader loader, <span class="keyword">final</span> Object externalContext,<span class="keyword">final</span> <span class="keyword">boolean</span> currentContext)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//å®ä¾‹åŒ–LoggerContext</span></span><br><span class="line">   <span class="keyword">final</span> LoggerContext ctx = selector.getContext(fqcn, loader, currentContext);</span><br><span class="line">   <span class="keyword">if</span> (externalContext != <span class="keyword">null</span> &amp;&amp; ctx.getExternalContext() == <span class="keyword">null</span>) &#123;</span><br><span class="line">       ctx.setExternalContext(externalContext);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> (ctx.getState() == LifeCycle.State.INITIALIZED) &#123;</span><br><span class="line">       ctx.start();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> ctx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºï¼Œé¦–å…ˆä¼šæ‹¿ClassLoaderå»ç¼“å­˜ä¸­æ‹¿ï¼Œå¦‚æœæœ‰åˆ™ç›´æ¥è¿”å›ï¼Œæ²¡æœ‰åˆ™åˆ›å»ºä¸€ä¸ªã€‚<br>å› ä¸ºæ˜¯<strong>æ ¹æ®ClassLoaderæ¥è¿›è¡Œç¼“å­˜LoggerContext</strong>ï¼Œæ‰€ä»¥å¯¹äºåŒä¸€ä¸ªåº”ç”¨æ¥è¯´å…¶æ‰€æœ‰çš„æ—¥å¿—å¯¹è±¡å¯¹åº”åŒä¸€ä¸ªLoggerContextã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> LoggerContext <span class="title">locateContext</span><span class="params">(<span class="keyword">final</span> ClassLoader loaderOrNull, <span class="keyword">final</span> URI configLocation)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">final</span> ClassLoader loader = loaderOrNull != <span class="keyword">null</span> ? loaderOrNull : ClassLoader.getSystemClassLoader();</span><br><span class="line">   <span class="keyword">final</span> String name = toContextMapKey(loader);</span><br><span class="line">   <span class="comment">//æ­¤å¤„ï¼Œé¦–å…ˆä¼šä»CONTEXT_MAPä¸­æŸ¥çœ‹æŒ‡å®šç±»å‹ClassLoaderçš„LoggerContextæ˜¯å¦å·²ç»å­˜åœ¨ï¼Œ</span></span><br><span class="line">   <span class="comment">//è‹¥å­˜åœ¨åˆ™ç›´æ¥è¿”å›ï¼Œè¿™é‡Œä¹Ÿèƒ½çœ‹åˆ°ä¸ºä»€ä¹ˆOSGIæ¯ä¸ªBudleæœ‰ä¸åŒçš„æ—¥å¿—ç³»ç»Ÿã€‚</span></span><br><span class="line">   AtomicReference&lt;WeakReference&lt;LoggerContext&gt;&gt; ref = CONTEXT_MAP.get(name);</span><br><span class="line">   <span class="keyword">if</span> (ref == <span class="keyword">null</span>) &#123;</span><br><span class="line">       <span class="keyword">if</span> (configLocation == <span class="keyword">null</span>) &#123;</span><br><span class="line">           ClassLoader parent = loader.getParent();</span><br><span class="line">           <span class="keyword">while</span> (parent != <span class="keyword">null</span>) &#123;</span><br><span class="line">               ref = CONTEXT_MAP.get(toContextMapKey(parent));</span><br><span class="line">               <span class="keyword">if</span> (ref != <span class="keyword">null</span>) &#123;</span><br><span class="line">                   <span class="keyword">final</span> WeakReference&lt;LoggerContext&gt; r = ref.get();</span><br><span class="line">                   <span class="keyword">final</span> LoggerContext ctx = r.get();</span><br><span class="line">                   <span class="keyword">if</span> (ctx != <span class="keyword">null</span>) &#123;</span><br><span class="line">                       <span class="keyword">return</span> ctx;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">               parent = parent.getParent();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//å®ä¾‹åŒ–ä¸€ä¸ªLoggerContextï¼Œå¹¶å°†LoggerContextæ”¾è¿›CONTEXT_MAPä¸­</span></span><br><span class="line">       LoggerContext ctx = createContext(name, configLocation);</span><br><span class="line">       <span class="keyword">final</span> AtomicReference&lt;WeakReference&lt;LoggerContext&gt;&gt; r = <span class="keyword">new</span> AtomicReference&lt;&gt;();</span><br><span class="line">       r.set(<span class="keyword">new</span> WeakReference&lt;&gt;(ctx));</span><br><span class="line">       CONTEXT_MAP.putIfAbsent(name, r);</span><br><span class="line">       ctx = CONTEXT_MAP.get(name).get().get();</span><br><span class="line">       <span class="keyword">return</span> ctx;</span><br><span class="line">   &#125;</span><br><span class="line">   ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>LoggerContextçš„åˆå§‹åŒ–æ–¹æ³•<code>start</code>ä¼šé—´æ¥è°ƒç”¨reconfigure(URI) ï¼ˆstart() -&gt; reconfigure() -&gt; reconfigure(URI)ï¼‰ï¼Œå…¶æ˜¯<strong>åŠ è½½å¹¶è§£æé…ç½®æ–‡ä»¶çš„æ ¸å¿ƒå†…å®¹</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">reconfigure</span><span class="params">(<span class="keyword">final</span> URI configURI)</span> </span>&#123;</span><br><span class="line">   final ClassLoader cl = ClassLoader.class.isInstance(externalContext) ? (ClassLoader) externalContext : null;</span><br><span class="line">   <span class="comment">//é€šè¿‡é…ç½®å·¥å‚ç”Ÿæˆé…ç½®ç±»</span></span><br><span class="line">   <span class="keyword">final</span> Configuration instance = ConfigurationFactory.getInstance().getConfiguration(name, configURI, cl);</span><br><span class="line">   <span class="comment">//å¯¹Configurationä¸­çš„æ ‘å½¢ç»“æ„æ•°æ®è¿›è¡Œè§£ææˆå¯¹è±¡ï¼Œç„¶åè®¾ç½®åˆ°LogerContextä¸­</span></span><br><span class="line">   setConfiguration(instance);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸»è¦å†…å®¹å¦‚ä¸‹ï¼š</p>
<ol>
<li>é¦–å…ˆè·å–æ‰€æœ‰å¯ç”¨çš„é…ç½®å·¥å‚(ConfigurationFactory)ï¼Œç„¶åæ ¹æ®åº”ç”¨ä¸­æœ‰çš„çš„é…ç½®æ–‡ä»¶ç±»å‹ï¼ˆyml|json|xmlï¼‰æ¥é€‚é…ä¸€ç§é…ç½®å¯¹è±¡ç”Ÿæˆå·¥å‚ï¼Œé€šè¿‡å·¥å‚å¯¹è±¡ç”Ÿæˆç›¸åº”çš„é…ç½®å¯¹è±¡ã€‚ä¸‹é¢å°†ä»¥XMLConfigurationFactoryä¸ºä¾‹ï¼Œæ¥ä»‹ç»XMLConfigurationçš„ç”Ÿæˆå’Œæ–‡ä»¶è§£æè¿‡ç¨‹ã€‚å…¶ä»–ä¸¤ç§ï¼ˆ<code>YamlConfigurationFactory</code>,<code>JsonConfigurationFactory</code>ï¼‰ç±»ä¼¼ã€‚<ul>
<li>åœ¨ç”ŸæˆXMLConfigurationçš„åŒæ—¶ï¼Œä¹Ÿä¼šåˆ©ç”¨XMLè§£æå™¨å°†é…ç½®æ–‡ä»¶è§£ææˆDocumentç±»å‹ï¼Œä¾¿äºåé¢è§£æã€‚</li>
</ul>
</li>
<li><code>setConfiguration(instance)</code>æ˜¯å°†Xmlæ–‡æ¡£å¯¹è±¡è§£ææˆçœŸæ­£çš„æ—¥å¿—å¯¹è±¡çš„ä¸»è¦è¿‡ç¨‹ã€‚å…¶è°ƒç”¨startæ–¹æ³•æ¥å®Œæˆè§£æçš„æ•´ä¸ªè¿‡ç¨‹ã€‚</li>
</ol>
<p>è§£æçš„è¿‡ç¨‹åˆ†ä¸¤æ­¥ï¼š1.<code>setup</code>åˆ©ç”¨XMLæ–‡æ¡£å¯¹è±¡æ„å»ºèµ·Nodeé…ç½®ä¿¡æ¯ç»“æ„æ ‘ï¼ˆå¸¦æœ‰XMLæ ‡ç­¾å¯¹åº”çš„æ’ä»¶ç±»å‹ä¿¡æ¯ï¼‰; 2.<code>doConfigure</code>åˆ©ç”¨Nodeé…ç½®ä¿¡æ¯ç»“æ„æ ‘ï¼Œè¿›ä¸€æ­¥å®Œæˆä»æ’ä»¶å¯¹è±¡åˆ°å®ä½“å¯¹è±¡çš„è½¬æ¢ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">this</span>.setStarting();</span><br><span class="line">   ...</span><br><span class="line">   <span class="comment">//é€šè¿‡é€’å½’çš„æ–¹å¼å°†XMlçš„æ ‡ç­¾å…ƒç´ è½¬æ¢æˆNode(æ’ä»¶ç±»)</span></span><br><span class="line">   setup();</span><br><span class="line">   setupAdvertisement();</span><br><span class="line">   <span class="comment">//é€šè¿‡åå°„çš„å½¢å¼å°†å¸¦æ’ä»¶ç±»å‹çš„Nodeè½¬æ¢æˆçœŸæ­£çš„ç±»å‹å¹¶å®ä¾‹åŒ–ç›¸åº”çš„å¯¹è±¡ï¼Œå¹¶è®¾ç½®åˆ°XMlConfigurationå±æ€§ä¸­</span></span><br><span class="line">   doConfigure();</span><br><span class="line">   ...</span><br><span class="line">   <span class="keyword">super</span>.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>setup</code>æ–¹æ³•é€šè¿‡é€’å½’è°ƒç”¨<code>constructHierarchy</code>å®Œæˆä»XMLæ ‡ç­¾å…ƒç´ åˆ°Nodeçš„è½¬æ¢ï¼ŒNodeä¸­æœ€é‡è¦çš„å±æ€§æ˜¯PluginTypeä¿¡æ¯ï¼Œå®ƒæ˜¯é…ç½®æ–‡ä»¶Tagæ ‡ç­¾å¯¹åº”çš„æ’ä»¶ç±»ã€‚ï¼ˆpluginManageræ˜¯å•¥ï¼Ÿä¸ºå•¥èƒ½æ ¹æ®tagæ ‡ç­¾åè·å–æ’ä»¶ç±»å‹ï¼Ÿ<strong>ç•™åˆ°æœ€åè®²è§£</strong>ï¼‰</p>
<blockquote>
<p>ä»¥<code>&lt;Console&gt;</code>æ ‡ç­¾ä¸ºä¾‹ï¼Œå®ƒçš„æ’ä»¶ç±»å‹ä¸º<code>ConsoleAppender</code></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   ...</span><br><span class="line">   constructHierarchy(rootNode, rootElement);</span><br><span class="line">   ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">constructHierarchy</span><span class="params">(<span class="keyword">final</span> Node node, <span class="keyword">final</span> Element element)</span> </span>&#123;</span><br><span class="line">   processAttributes(node, element);</span><br><span class="line">   <span class="keyword">final</span> StringBuilder buffer = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">   <span class="keyword">final</span> NodeList list = element.getChildNodes();</span><br><span class="line">   <span class="keyword">final</span> List&lt;Node&gt; children = node.getChildren();</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; list.getLength(); i++) &#123;</span><br><span class="line">       <span class="keyword">final</span> org.w3c.dom.Node w3cNode = list.item(i);</span><br><span class="line">       <span class="keyword">if</span> (w3cNode <span class="keyword">instanceof</span> Element) &#123;</span><br><span class="line">           <span class="keyword">final</span> Element child = (Element) w3cNode;</span><br><span class="line">           <span class="comment">//è·å–å…ƒç´ çš„åç§°ï¼Œå¹¶é€šè¿‡åç§°è·å–å¯¹åº”çš„æ’ä»¶ç±»ä¿¡æ¯ï¼Œæ„å»ºä¸é…ç½®æ–‡ä»¶ç»“æ„ä¸€ä¸€å¯¹åº”çš„Nodeæ ‘ç»“æ„ã€‚</span></span><br><span class="line">           <span class="comment">//å¦‚ä¸Šä¸€å±Šçš„Consoleï¼Œå®ƒçš„æ’ä»¶ç±»å‹ä¸ºConsoleAppender</span></span><br><span class="line">           <span class="keyword">final</span> String name = getType(child);</span><br><span class="line">           <span class="keyword">final</span> PluginType&lt;?&gt; type = pluginManager.getPluginType(name);</span><br><span class="line">           <span class="keyword">final</span> Node childNode = <span class="keyword">new</span> Node(node, name, type);</span><br><span class="line">           <span class="comment">//é€’å½’ DFS</span></span><br><span class="line">           constructHierarchy(childNode, child);</span><br><span class="line">           <span class="keyword">if</span> (type == <span class="keyword">null</span>) &#123;</span><br><span class="line">               <span class="keyword">final</span> String value = childNode.getValue();</span><br><span class="line">               <span class="keyword">if</span> (!childNode.hasChildren() &amp;&amp; value != <span class="keyword">null</span>) &#123;</span><br><span class="line">                   node.getAttributes().put(name, value);</span><br><span class="line">               &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                   status.add(<span class="keyword">new</span> Status(name, element, ErrorType.CLASS_NOT_FOUND));</span><br><span class="line">               &#125;</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               children.add(childNode);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; <span class="keyword">else</span> <span class="keyword">if</span> (w3cNode <span class="keyword">instanceof</span> Text) &#123;</span><br><span class="line">           <span class="keyword">final</span> Text data = (Text) w3cNode;</span><br><span class="line">           buffer.append(data.getData());</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">final</span> String text = buffer.toString().trim();</span><br><span class="line">   <span class="keyword">if</span> (text.length() &gt; <span class="number">0</span> || (!node.hasChildren() &amp;&amp; !node.isRoot())) &#123;</span><br><span class="line">       node.setValue(text);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>doConfigure</code> é€’å½’æ‰§è¡Œ<code>createConfiguration</code>æ–¹æ³•ï¼Œå…¶é€šè¿‡æ’ä»¶ç±»ä¿¡æ¯æ„å»ºæ—¥å¿—å¯¹è±¡ï¼ˆ<code>Appender</code>ã€<code>LogerConfig</code>ã€<code>Filter</code>ï¼‰ã€‚åˆ›å»ºå®Œæ—¥å¿—æˆå‘˜å¯¹è±¡åï¼Œä¼šè¿›ä¸€æ­¥å»ºç«‹ä»–ä»¬ä¹‹é—´çš„è”ç³»ã€‚æœ€åå¯¹äº<code>LogerConfig</code>ä¼šæ„å»ºèµ·å…¶å±‚æ¬¡ç»“æ„ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doConfigure</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   ...</span><br><span class="line">   <span class="keyword">boolean</span> setLoggers = <span class="keyword">false</span>;</span><br><span class="line">   <span class="keyword">boolean</span> setRoot = <span class="keyword">false</span>;</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">final</span> Node child : rootNode.getChildren()) &#123;</span><br><span class="line">       ...</span><br><span class="line">       <span class="comment">//å…³é”®ï¼ï¼</span></span><br><span class="line">       createConfiguration(child, <span class="keyword">null</span>);</span><br><span class="line">       <span class="keyword">if</span> (child.getObject() == <span class="keyword">null</span>) &#123;</span><br><span class="line">           <span class="keyword">continue</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span> (child.getName().equalsIgnoreCase(<span class="string">"Appenders"</span>)) &#123;</span><br><span class="line">           appenders = child.getObject();</span><br><span class="line">       &#125; <span class="keyword">else</span> <span class="keyword">if</span> (child.isInstanceOf(Filter<span class="class">.<span class="keyword">class</span>)) </span>&#123;</span><br><span class="line">           addFilter(child.getObject(Filter<span class="class">.<span class="keyword">class</span>))</span>;</span><br><span class="line">       &#125; <span class="keyword">else</span> <span class="keyword">if</span> (child.getName().equalsIgnoreCase(<span class="string">"Loggers"</span>)) &#123;</span><br><span class="line">           <span class="keyword">final</span> Loggers l = child.getObject();</span><br><span class="line">           loggers = l.getMap();</span><br><span class="line">           setLoggers = <span class="keyword">true</span>;</span><br><span class="line">           <span class="keyword">if</span> (l.getRoot() != <span class="keyword">null</span>) &#123;</span><br><span class="line">               root = l.getRoot();</span><br><span class="line">               setRoot = <span class="keyword">true</span>;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;...</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="comment">// å»ºç«‹èµ· LogerConfigä¸Appenderä¹‹é—´çš„å¼•ç”¨å…³ç³»</span></span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">final</span> Map.Entry&lt;String, LoggerConfig&gt; entry : loggers.entrySet()) &#123;</span><br><span class="line">       <span class="keyword">final</span> LoggerConfig l = entry.getValue();</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">final</span> AppenderRef ref : l.getAppenderRefs()) &#123;</span><br><span class="line">           <span class="keyword">final</span> Appender app = appenders.get(ref.getRef());</span><br><span class="line">           <span class="keyword">if</span> (app != <span class="keyword">null</span>) &#123;</span><br><span class="line">               l.addAppender(app, ref.getLevel(), ref.getFilter());</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               LOGGER.error(<span class="string">"Unable to locate appender &#123;&#125; for logger &#123;&#125;"</span>, ref.getRef(), l.getName());</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// æ„å»ºèµ·LogerConfigä¹‹é—´çš„çˆ¶å­å…³ç³»ï¼ˆé€šè¿‡nameï¼‰</span></span><br><span class="line">   setParents();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>createConfiguration</code>ä¼šè°ƒåŠ¨<code>createPluginObject(type, node, event)</code>æ–¹æ³•æ¥ç”Ÿæˆå¯¹è±¡</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createConfiguration</span><span class="params">(<span class="keyword">final</span> Node node, <span class="keyword">final</span> LogEvent event)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">final</span> PluginType&lt;?&gt; type = node.getType();</span><br><span class="line">   <span class="keyword">if</span> (type != <span class="keyword">null</span> &amp;&amp; type.isDeferChildren()) &#123;</span><br><span class="line">       node.setObject(createPluginObject(type, node, event));</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">final</span> Node child : node.getChildren()) &#123;</span><br><span class="line">           createConfiguration(child, event);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span> (type == <span class="keyword">null</span>) &#123;</span><br><span class="line">           <span class="keyword">if</span> (node.getParent() != <span class="keyword">null</span>) &#123;</span><br><span class="line">               LOGGER.error(<span class="string">"Unable to locate plugin for &#123;&#125;"</span>, node.getName());</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           node.setObject(createPluginObject(type, node, event));</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æ„å»ºå™¨æ¥ç©¿ä»¶å¯¹è±¡ï¼Œé¦–å…ˆé€šè¿‡<code>createBuilder(this.class)</code>æ¥åˆ›å»ºæ„å»ºå™¨ï¼Œç„¶åï¼Œé€šè¿‡åå°„å¯¹æ„å»ºå™¨è®¾ç½®å±æ€§å€¼ï¼Œæœ€åè°ƒç”¨æ„å»ºå™¨çš„<code>build()</code>æ¥ç”Ÿæˆå¯¹è±¡ã€‚é€šè¿‡å·¥å‚çš„æ–¹å¼ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Object <span class="title">createPluginObject</span><span class="params">(<span class="keyword">final</span> PluginType&lt;?&gt; type, <span class="keyword">final</span> Node node, <span class="keyword">final</span> LogEvent event)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">final</span> Class&lt;?&gt; clazz = type.getPluginClass();</span><br><span class="line">   ...</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> PluginBuilder(type)</span><br><span class="line">           .withConfiguration(<span class="keyword">this</span>)</span><br><span class="line">           .withConfigurationNode(node)</span><br><span class="line">           .forLogEvent(event)</span><br><span class="line">           .build();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   verify();</span><br><span class="line">   <span class="comment">// first try to use a builder class if one is available</span></span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">       <span class="keyword">final</span> Builder&lt;?&gt; builder = createBuilder(<span class="keyword">this</span>.clazz);</span><br><span class="line">       <span class="keyword">if</span> (builder != <span class="keyword">null</span>) &#123;</span><br><span class="line">           injectFields(builder);</span><br><span class="line">           <span class="keyword">final</span> Object result = builder.build();</span><br><span class="line">           <span class="keyword">return</span> result;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;...</span><br><span class="line">   <span class="comment">// or fall back to factory method if no builder class is available</span></span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">       <span class="keyword">final</span> Method factory = findFactoryMethod(<span class="keyword">this</span>.clazz);</span><br><span class="line">       <span class="keyword">final</span> Object[] params = generateParameters(factory);</span><br><span class="line">       <span class="keyword">final</span> Object plugin = factory.invoke(<span class="keyword">null</span>, params);</span><br><span class="line">       <span class="keyword">return</span> plugin;</span><br><span class="line">   &#125;...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>createBuilder(this.clazz)</code>æ˜¯é€šè¿‡åå°„çš„å½¢å¼æ‰«æclazzç±»çš„æ–¹æ³•ï¼Œæ‰¾åˆ°å¸¦æœ‰<code>@PluginBuilderFactory</code>æ³¨è§£é™æ€æ–¹æ³•ï¼Œå¹¶è°ƒç”¨å®ƒæ¥ç”Ÿæˆæ„å»ºå™¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Builder&lt;?&gt; createBuilder(<span class="keyword">final</span> Class&lt;?&gt; clazz)</span><br><span class="line">        <span class="keyword">throws</span> InvocationTargetException, IllegalAccessException &#123;</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">final</span> Method method : clazz.getDeclaredMethods()) &#123;</span><br><span class="line">   <span class="comment">//é€šè¿‡åå°„è·å–åŠ äº† @PluginBuilderFactory çš„æ–¹æ³•ï¼Œå¹¶é€šè¿‡åå°„è°ƒç”¨æ­¤æ–¹æ³•æ¥è·å–æ„å»ºå™¨ã€‚</span></span><br><span class="line">       <span class="keyword">if</span> (method.isAnnotationPresent(PluginBuilderFactory<span class="class">.<span class="keyword">class</span>) &amp;&amp;</span></span><br><span class="line"><span class="class">           <span class="title">Modifier</span>.<span class="title">isStatic</span>(<span class="title">method</span>.<span class="title">getModifiers</span>()) &amp;&amp;</span></span><br><span class="line"><span class="class">           <span class="title">TypeUtil</span>.<span class="title">isAssignable</span>(<span class="title">Builder</span>.<span class="title">class</span>, <span class="title">method</span>.<span class="title">getGenericReturnType</span>())) </span>&#123;</span><br><span class="line">           ReflectionUtil.makeAccessible(method);</span><br><span class="line">           <span class="keyword">final</span> Builder&lt;?&gt; builder = (Builder&lt;?&gt;) method.invoke(<span class="keyword">null</span>);</span><br><span class="line">           <span class="keyword">return</span> builder;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¥çœ‹ä¸€ä¸ªå…·ä½“çš„æ —å­ï¼ŒåŠ æ·±ç†è§£ã€‚</p>
<p>é…ç½®æ–‡ä»¶ä¸­é…ç½®äº†ä¸€ä¸ªè¿½åŠ å™¨ <code>Console</code>ï¼Œå…¶å¯¹åº”çš„æ’ä»¶ç±»å‹ä¸º <code>ConsoleAppender</code>ã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">status</span>=<span class="string">"WARN"</span> <span class="attr">monitorInterval</span>=<span class="string">"1000"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Console</span> <span class="attr">name</span>=<span class="string">"Console"</span> <span class="attr">target</span>=<span class="string">"SYSTEM_OUT"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"[%level][%date&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;][%thread][%class][%method][%line]:%message%n"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Console</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol>
<li>åœ¨<code>setup()</code>æ–¹æ³•ä¸­ä¼šå°†XMLè½¬æ¢æˆ<code>Node(PluginType=ConsoleAppender.class,...)</code></li>
<li>åœ¨doConfigureæ–¹æ³•ä¸­ä¼šæ‰«æConsoleAppenderç±»çš„æ‰€æœ‰æ–¹æ³•ï¼Œæ‰¾åˆ°å¸¦æœ‰<code>@PluginBuilderFactory</code>çš„é™æ€æ–¹æ³•<code>newBuilder()</code>ï¼Œé€šè¿‡è°ƒç”¨<code>newBuilder</code>æ–¹æ³•è·å¾—æ„é€ å™¨<code>ConsoleAppender.Builder</code></li>
</ol>
<p>åˆ°æ­¤ï¼ŒLoggerContextçš„åˆå§‹åŒ–å°±å®Œæˆäº†ã€‚</p>
<h2 id="2-é€šè¿‡LoggerContextè·å–Logger"><a href="#2-é€šè¿‡LoggerContextè·å–Logger" class="headerlink" title="2. é€šè¿‡LoggerContextè·å–Logger"></a>2. é€šè¿‡LoggerContextè·å–Logger</h2><p>é€šè¿‡LoggerContextè·å–Loggerçš„é€»è¾‘æ¯”è¾ƒç®€å•ã€‚</p>
<ol>
<li>é¦–å…ˆå°è¯•ä»ç¼“å­˜ä¸­è·å–ï¼Œæœ‰åˆ™ç›´æ¥è¿”å›ï¼Œæ²¡æœ‰åˆ™åˆ°ä¸‹ä¸€æ­¥ï¼›</li>
<li>è°ƒç”¨<code>newInstance</code>æ¥åˆ›å»ºä¸€ä¸ªLoggerã€‚</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Logger <span class="title">getLogger</span><span class="params">(<span class="keyword">final</span> String name)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> getLogger(name, <span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Logger <span class="title">getLogger</span><span class="params">(<span class="keyword">final</span> String name, <span class="keyword">final</span> MessageFactory messageFactory)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//å…ˆå°è¯•ä»ç¼“å­˜ä¸­</span></span><br><span class="line">   Logger logger = loggers.get(name);</span><br><span class="line">   <span class="keyword">if</span> (logger != <span class="keyword">null</span>) &#123;</span><br><span class="line">       AbstractLogger.checkMessageFactory(logger, messageFactory);</span><br><span class="line">       <span class="keyword">return</span> logger;</span><br><span class="line">   &#125;</span><br><span class="line">   logger = newInstance(<span class="keyword">this</span>, name, messageFactory);</span><br><span class="line">   <span class="keyword">final</span> Logger prev = loggers.putIfAbsent(name, logger);</span><br><span class="line">   <span class="keyword">return</span> prev == <span class="keyword">null</span> ? logger : prev;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>newInstance</code>æ–¹æ³•é—´æ¥è°ƒç”¨ Loggerçš„æ„é€ å‡½æ•°æ¥å®ä¾‹åŒ–ä¸€ä¸ªLoggerå¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="title">Logger</span><span class="params">(<span class="keyword">final</span> LoggerContext context, <span class="keyword">final</span> String name, <span class="keyword">final</span> MessageFactory messageFactory)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">super</span>(name, messageFactory);</span><br><span class="line">   <span class="keyword">this</span>.context = context;</span><br><span class="line">   config = <span class="keyword">new</span> PrivateConfig(context.getConfiguration(), <span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼ŒPrivateConfigå»ºç«‹èµ·Loggerä¸å…·ä½“çš„LoggerConfigçš„å…³è”ã€‚<br><code>getLoggerConfig</code>æ–¹æ³•ä¸­å¯ä»¥çœ‹å‡ºï¼š<br>    1. å…ˆé€šè¿‡Loggerçš„åç§°çœ‹æ˜¯å¦æœ‰ä¸å…¶åç§°ä¸€è‡´çš„LoggerConfigï¼Œæœ‰åˆ™è¿”å›ï¼›<br>    2. é€šè¿‡ä»¥ <code>.</code>ä¸ºåˆ†å‰²ç¬¦ï¼Œä»åå¾€å‰æˆªå–å­—ç¬¦ä¸²<code>name.substring(0,name.lastIndexOf(&#39;.&#39;))</code>ï¼Œå¹¶ä»¥æ­¤æ¥å¯»æ‰¾æ˜¯å¦èƒ½æ‰¾åˆ°ç›¸åº”çš„LoggerConfigã€‚è‹¥éƒ½æ²¡æ‰¾åˆ°ï¼Œåˆ™ç›´æ¥è¿”å›æ ¹LoggerConfig</p>
<blockquote>
<p>æ¯”å¦‚Loggerçš„åç§°ä¸ºcom.maoyan.order.bizï¼Œä¼šé¡ºåºæŸ¥æ‰¾æ˜¯å¦æœ‰ ä»¥ â€œcom.maoyan.order.bizâ€ã€â€œcom.maoyan.orderâ€ â€œcom.maoyanâ€ã€â€œcomâ€å‘½åçš„LoggerConfigï¼Œè‹¥æ‰¾åˆ°åˆ™ç›´æ¥è¿”å›ï¼Œå¦åˆ™è¿”å›æ ¹LoggerConfig</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">PrivateConfig</span><span class="params">(<span class="keyword">final</span> Configuration config, <span class="keyword">final</span> Logger logger)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.config = config;</span><br><span class="line">  <span class="keyword">this</span>.loggerConfig = config.getLoggerConfig(getName());</span><br><span class="line">  <span class="keyword">this</span>.level = <span class="keyword">this</span>.loggerConfig.getLevel();</span><br><span class="line">  <span class="keyword">this</span>.intLevel = <span class="keyword">this</span>.level.intLevel();</span><br><span class="line">  <span class="keyword">this</span>.logger = logger;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//AbstractConfigçš„getLoggerConfig</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> LoggerConfig <span class="title">getLoggerConfig</span><span class="params">(<span class="keyword">final</span> String name)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (loggers.containsKey(name)) &#123;</span><br><span class="line">       <span class="keyword">return</span> loggers.get(name);</span><br><span class="line">   &#125;</span><br><span class="line">   String substr = name;</span><br><span class="line">   <span class="keyword">while</span> ((substr = NameUtil.getSubName(substr)) != <span class="keyword">null</span>) &#123;</span><br><span class="line">       <span class="keyword">if</span> (loggers.containsKey(substr)) &#123;</span><br><span class="line">           <span class="keyword">return</span> loggers.get(substr);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/media/14930152428677.jpg" alt="set up-w666"></p>
<p>æœ€ç»ˆå°±å®Œæˆäº†Loggerå¯¹è±¡çš„åˆ›å»ºã€‚</p>
<h2 id="3-è§¦å‘æ—¥å¿—äº‹ä»¶"><a href="#3-è§¦å‘æ—¥å¿—äº‹ä»¶" class="headerlink" title="3. è§¦å‘æ—¥å¿—äº‹ä»¶"></a>3. è§¦å‘æ—¥å¿—äº‹ä»¶</h2><p>ä¸‹é¢å°†ä»ä¸€æ¡æ—¥å¿—è¯­å¥å‡ºå‘ï¼Œåˆ†æè¿›è¡Œæ—¥å¿—æ“ä½œçš„è¿‡ç¨‹ä¸­ï¼Œç»è¿‡äº†å“ªäº›è¿‡ç¨‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logger.info(<span class="string">"Hello World"</span>);</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆï¼Œè¿™æ¡æ—¥å¿—ä¼šé—´æ¥è°ƒç”¨AbstractLoggerä¸­çš„<code>logIfEnabled</code>æ–¹æ³•ï¼Œå…¶ä¸­<code>IsEnabled</code> ä¼šç¬¬ä¸€æ¬¡è°ƒç”¨<code>Filter</code>å¯¹è±¡ï¼Œåˆ¤æ–­æ˜¯å¦å¯ä»¥ç»§ç»­ä¸‹å»ï¼›è‹¥Configurationæ²¡æœ‰é…ç½®<code>Filter</code>ï¼Œåˆ™åˆ¤æ–­æ—¥å¿—äº‹ä»¶çš„Levelæ˜¯å¦å¤§äºå¯¹åº”çš„LoggerConfigçš„Levelã€‚ps:è¿™é‡Œçš„<code>Filter</code>æ˜¯<strong>Configurationçš„å…¨å±€<code>Filter</code></strong>ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logIfEnabled</span><span class="params">(<span class="keyword">final</span> String fqcn, <span class="keyword">final</span> Level level, <span class="keyword">final</span> Marker marker, <span class="keyword">final</span> String message,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">final</span> Throwable t)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (isEnabled(level, marker, message, t)) &#123;</span><br><span class="line">       logMessage(fqcn, level, marker, message, t);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“æ“ä½œä¸è¢«æ‹¦æˆªåï¼Œè¿›å…¥Loggerçš„<code>logMessage</code>æ–¹æ³•ã€‚å¯ä»¥çœ‹å‡ºï¼Œæ“ä½œæœ€ç»ˆäº¤ç”±LoggerConfigæ¥å¤„ç†ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logMessage</span><span class="params">(<span class="keyword">final</span> String fqcn, <span class="keyword">final</span> Level level, <span class="keyword">final</span> Marker marker, <span class="keyword">final</span> Message message, <span class="keyword">final</span> Throwable t)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">final</span> Message msg = message == <span class="keyword">null</span> ? <span class="keyword">new</span> SimpleMessage(Strings.EMPTY) : message;</span><br><span class="line">   config.config.getConfigurationMonitor().checkConfiguration();</span><br><span class="line">    <span class="comment">//ç”±LoggerConfigæ¥æ‰§è¡Œæ“ä½œ</span></span><br><span class="line">   config.loggerConfig.log(getName(), fqcn, marker, level, msg, t);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>LoggerConfigçš„<code>log</code>æ–¹æ³•ä¼šå¯¹æ—¥å¿—æ“ä½œè¿›è¡Œä¸€æ¬¡åŒ…è£…ï¼Œå°è£…æˆLogEventï¼Œéšåè°ƒç”¨<code>log(event)</code>æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">(<span class="keyword">final</span> String loggerName, <span class="keyword">final</span> String fqcn,<span class="keyword">final</span> Marker marker, <span class="keyword">final</span> Level level, <span class="keyword">final</span> Message data,<span class="keyword">final</span> Throwable t)</span> </span>&#123;</span><br><span class="line">   ...</span><br><span class="line">   <span class="keyword">final</span> LogEvent event = logEventFactory.createEvent(loggerName, marker, fqcn, level, data, props, t);</span><br><span class="line">   log(event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹å‡ºï¼Œç¬¬äºŒæ¬¡è°ƒç”¨<code>filter</code>ï¼Œè¿™é‡Œè°ƒç”¨çš„æ˜¯<strong>LoggerConfigé…ç½®çš„Filter</strong>ã€‚è¿›è¡Œè¿‡æ»¤åå¼€å§‹è°ƒç”¨LoggerConfigä¸­é…ç½®çš„æ¯ä¸ªAppenderã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">(<span class="keyword">final</span> LogEvent event)</span> </span>&#123;</span><br><span class="line">   ...</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">       <span class="keyword">if</span> (isFiltered(event)) &#123;</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       event.setIncludeLocation(isIncludeLocation());</span><br><span class="line">       callAppenders(event);</span><br><span class="line">       <span class="keyword">if</span> (additive &amp;&amp; parent != <span class="keyword">null</span>) &#123;</span><br><span class="line">           parent.log(event);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125; ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ–¹æ³•ä¸­è¿›è¡Œäº†ä¸¤æ¬¡è¿‡æ»¤ï¼Œç¬¬ä¸€æ¬¡æ˜¯è°ƒç”¨Appenderçš„Filterè¿›è¡Œè¿‡æ»¤ï¼Œç¬¬äºŒæ¬¡å½“Appenderå®ç°äº†Filerableæ¥å£æ—¶ï¼Œåˆ™æ‰§è¡Œæ¥å£æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">callAppender</span><span class="params">(<span class="keyword">final</span> LogEvent event)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (getFilter() != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="comment">//ç¬¬ä¸‰æ¬¡è°ƒç”¨filterï¼Œæ­¤å¤„çš„Filterä¸ºAppenderçš„Filter</span></span><br><span class="line">       <span class="keyword">final</span> Filter.Result r = getFilter().filter(event);</span><br><span class="line">       <span class="keyword">if</span> (r == Filter.Result.DENY) &#123;</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> (level != <span class="keyword">null</span> &amp;&amp; intLevel &lt; event.getLevel().intLevel()) &#123;</span><br><span class="line">       <span class="keyword">return</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> (recursive.get() != <span class="keyword">null</span>) &#123;</span><br><span class="line">       appender.getHandler().error(<span class="string">"Recursive call to appender "</span> + appender.getName());</span><br><span class="line">       <span class="keyword">return</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">       recursive.set(<span class="keyword">this</span>);</span><br><span class="line">       ...</span><br><span class="line">       <span class="comment">//ç¬¬å››æ¬¡è°ƒç”¨ï¼Œå½“Appenderæ˜¯æ¥å£Filterableçš„å®ç°ç±»ï¼Œåˆ™è¿›è¡Œä¸€æ¬¡è¿‡æ»¤</span></span><br><span class="line">       <span class="keyword">if</span> (appender <span class="keyword">instanceof</span> Filterable &amp;&amp; ((Filterable) appender).isFiltered(event)) &#123;</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//è°ƒç”¨Appenderè¿›è¡Œè¿½åŠ </span></span><br><span class="line">           appender.append(event);</span><br><span class="line">       &#125;...</span><br><span class="line">   &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">       recursive.set(<span class="keyword">null</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-é™„åŠ ä¿¡æ¯"><a href="#4-é™„åŠ ä¿¡æ¯" class="headerlink" title="4. é™„åŠ ä¿¡æ¯"></a>4. é™„åŠ ä¿¡æ¯</h2><h3 id="è·å–ConfigurationFactory"><a href="#è·å–ConfigurationFactory" class="headerlink" title="è·å–ConfigurationFactory"></a>è·å–ConfigurationFactory</h3><p>ä¸Šé¢æåˆ°ConfigurationFactoryä¼šæ ¹æ®é…ç½®æ–‡ä»¶çš„æ–‡ä»¶ç±»å‹æ¥ä½¿ç”¨ç›¸åº”çš„é…ç½®å·¥å‚ç±»ï¼Œé‚£ä¹ˆæ•´ä¸ªè¿‡ç¨‹æ˜¯æ€ä¹ˆè¿›è¡Œçš„å‘¢ï¼Ÿ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Configuration instance = ConfigurationFactory.getInstance().getConfiguration(name, configURI, cl);</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆ<code>getInstance</code>æ–¹æ³•ä¼šæ”¶é›†æ‰€æœ‰å¯ç”¨çš„<code>ConfigurationFactory</code>,ç„¶å<code>getConfiguration</code>éå†æ‰€æœ‰å¯ç”¨çš„<code>ConfigurationFactory</code>ï¼Œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ConfigurationFactory <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (factories == <span class="keyword">null</span>) &#123;</span><br><span class="line">       LOCK.lock();</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="keyword">if</span> (factories == <span class="keyword">null</span>) &#123;</span><br><span class="line">               <span class="comment">//é¦–å…ˆï¼Œå¦‚æœç”¨æˆ·é…ç½®äº†log4j.configurationFactoryï¼Œåˆ™å°†æ­¤åŠ å…¥å¯ç”¨çš„ConfigurationFactoryé˜Ÿåˆ—ä¸­</span></span><br><span class="line">               <span class="keyword">final</span> List&lt;ConfigurationFactory&gt; list = <span class="keyword">new</span> ArrayList&lt;ConfigurationFactory&gt;();</span><br><span class="line">               <span class="keyword">final</span> String factoryClass = PropertiesUtil.getProperties().getStringProperty(CONFIGURATION_FACTORY_PROPERTY);</span><br><span class="line">               <span class="keyword">if</span> (factoryClass != <span class="keyword">null</span>) &#123;</span><br><span class="line">                   addFactory(list, factoryClass);</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="comment">//CATEGROY: ConfigurationFactoryï¼Œé€šè¿‡PluginManagerè·å–æ‰€æœ‰â€œConfigurationFactoryâ€ç±»å‹çš„æ’ä»¶ï¼ŒåŠ åˆ°å·¥å‚é˜Ÿåˆ—ä¸­</span></span><br><span class="line">               <span class="keyword">final</span> PluginManager manager = <span class="keyword">new</span> PluginManager(CATEGORY);</span><br><span class="line">               manager.collectPlugins();</span><br><span class="line">               <span class="keyword">final</span> Map&lt;String, PluginType&lt;?&gt;&gt; plugins = manager.getPlugins();</span><br><span class="line">               <span class="keyword">final</span> List&lt;Class&lt;? extends ConfigurationFactory&gt;&gt; ordered =</span><br><span class="line">                   <span class="keyword">new</span> ArrayList&lt;Class&lt;? extends ConfigurationFactory&gt;&gt;(plugins.size());</span><br><span class="line">               <span class="keyword">for</span> (<span class="keyword">final</span> PluginType&lt;?&gt; type : plugins.values()) &#123;</span><br><span class="line">                   <span class="keyword">try</span> &#123;</span><br><span class="line">                       ordered.add(type.getPluginClass().asSubclass(ConfigurationFactory<span class="class">.<span class="keyword">class</span>))</span>;</span><br><span class="line">                   &#125;...</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="comment">//æ¯ä¸ªå·¥å‚ç±»éƒ½æœ‰ä¸€ä¸ª@Order(n)æ³¨è§£ï¼ŒæŒ‰nçš„å¤§å°è¿›è¡Œæ’åº</span></span><br><span class="line">               Collections.sort(ordered, OrderComparator.getInstance());</span><br><span class="line">               <span class="keyword">for</span> (<span class="keyword">final</span> Class&lt;? extends ConfigurationFactory&gt; clazz : ordered) &#123;</span><br><span class="line">                   addFactory(list, clazz);</span><br><span class="line">               &#125;</span><br><span class="line">               factories = Collections.unmodifiableList(list);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">           LOCK.unlock();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> configFactory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è·å¾—æ‰€æœ‰å¯ç”¨çš„é…ç½®å·¥å‚åï¼Œæ¥ä¸‹æ¥å°±æ¥ç¡®å®šåˆ°åº•ç”¨é‚£ç§ç±»å‹çš„é…ç½®å·¥å‚ã€‚å…¶é€»è¾‘åœ¨<code>getConfiguration(isTest,name)</code>æ–¹æ³•ä¸­ã€‚</p>
<p><strong>éœ€è¦æ³¨æ„çš„æ˜¯</strong>ï¼šåœ¨èƒ½æ‰¾åˆ°å¤šä¸ªä¸åŒç±»å‹çš„æ—¥å¿—é…ç½®æ–‡ä»¶(jsonã€ymlã€xml)ï¼Œå› ä¸ºä¼šæŒ‰yml -&gt; json -&gt; xmlçš„é¡ºåºæ¥åŠ è½½é…ç½®æ–‡ä»¶å¹¶ç¡®å®šé…ç½®å·¥å‚ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Configuration <span class="title">getConfiguration</span><span class="params">(<span class="keyword">final</span> <span class="keyword">boolean</span> isTest, <span class="keyword">final</span> String name)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">boolean</span> named = name != <span class="keyword">null</span> &amp;&amp; name.length() &gt; <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">final</span> ClassLoader loader = LoaderUtil.getThreadContextClassLoader();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">final</span> ConfigurationFactory factory : factories) &#123;</span><br><span class="line">      String configName;</span><br><span class="line">      <span class="keyword">final</span> String prefix = isTest ? TEST_PREFIX : DEFAULT_PREFIX;</span><br><span class="line">      <span class="comment">//è·å–å·¥å‚æ”¯æŒçš„æ‰€æœ‰æ–‡ä»¶ç±»å‹ï¼Œç„¶åæ‹¼æ¥æˆæœ€ç»ˆçš„æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">      <span class="keyword">final</span> String [] types = factory.getSupportedTypes();</span><br><span class="line">      <span class="keyword">if</span> (types == <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">final</span> String suffix : types) &#123;</span><br><span class="line">          <span class="keyword">if</span> (suffix.equals(<span class="string">"*"</span>)) &#123;</span><br><span class="line">              <span class="keyword">continue</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          configName = named ? prefix + name + suffix : prefix + suffix;</span><br><span class="line">        <span class="comment">// å¦‚æœèƒ½åŠ è½½åˆ°æ–‡ä»¶åæ–‡ä»¶ï¼Œåˆ™è¿”å›è¯¥å·¥å‚ã€‚</span></span><br><span class="line">          <span class="keyword">final</span> ConfigurationSource source = getInputFromResource(configName, loader);</span><br><span class="line">          <span class="keyword">if</span> (source != <span class="keyword">null</span>) &#123;</span><br><span class="line">              <span class="keyword">return</span> factory.getConfiguration(source);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="PluginManagerçš„åˆå§‹åŒ–"><a href="#PluginManagerçš„åˆå§‹åŒ–" class="headerlink" title="PluginManagerçš„åˆå§‹åŒ–"></a>PluginManagerçš„åˆå§‹åŒ–</h3><p>åœ¨ä¸Šé¢æ•´ä¸ªåˆ†æè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥çœ‹åˆ°å¤šå¤„ç”¨åˆ°äº†<code>PluginManager</code>,é€šè¿‡å®ƒå¯ä»¥è·å¾—ç‰¹å®šç±»å‹çš„æ’ä»¶ï¼Œé‚£ä¹ˆè¿™äº›æ’ä»¶æ˜¯æ€ä¹ˆåˆå§‹åŒ–çš„å‘¢ï¼Ÿ</p>
<blockquote>
<p>äº‹å®ä¸Šï¼Œåœ¨PluginMangeråˆå§‹åŒ–æ—¶ï¼Œå…¶å±æ€§ pluginRegistryï¼ˆå•ä¾‹ï¼‰åˆå§‹åŒ–æ—¶ï¼Œä¼šè°ƒç”¨<code>decodeCacheFiles</code>æ–¹æ³•ç”¨äºä»META-INF/org/apache/logging/log4j/core/config/plugins/Log4j2Plugins.datæ–‡ä»¶ä¸­åŠ è½½å¹¶è§£ææ‰€æœ‰çš„æ’ä»¶ç±»å‹å¯¹è±¡ï¼Œå¹¶æŒ‰ç±»åˆ«å­˜å‚¨ã€‚ç›®å‰å…±æœ‰6ä¸­ç±»å‹æ’ä»¶ï¼šconverter,lookup,core,configurationfactory,fileconverter,typeconverter</p>
</blockquote>
<h3 id="PatternLayoutçš„ç‰¹æ®Šå¤„ç†"><a href="#PatternLayoutçš„ç‰¹æ®Šå¤„ç†" class="headerlink" title="PatternLayoutçš„ç‰¹æ®Šå¤„ç†"></a>PatternLayoutçš„ç‰¹æ®Šå¤„ç†</h3><p>åœ¨å¯¹é…ç½®æ–‡ä»¶è§£ææ—¶ï¼Œä¸€ä»¶æœ‰æ„æ€çš„äº‹æ˜¯ï¼Œå¯¹æ—¥å¿—è¾“å‡ºæ ·å¼çš„å¤„ç†ã€‚<br>åœ¨æ—¥å¿—ç³»ç»Ÿåˆå§‹åŒ–é˜¶æ®µï¼Œä¼šå¯¹å­—ç¬¦ä¸²å½¢å¼çš„è¾“å‡ºæ ·å¼è¿›è¡Œè§£æï¼Œå°†å…¶è½¬æ¢ä¸ºconvetorçš„åˆ—è¡¨ã€‚åœ¨æ—¥å¿—è¾“å‡ºæ—¶ï¼Œåªéœ€è¦é¡ºåºè°ƒç”¨è¿™äº›è½¬æ¢å™¨ï¼Œæ‹¼æ¥è¿”å›ç»“æœå¾—åˆ°è¾“å‡ºå†…å®¹ã€‚è¿™æ ·ä½¿å¾—æ—¥å¿—è¾“å‡ºæ•ˆç‡é«˜ã€‚<br><img src="/media/14933065402517.jpg" alt="set up-w888"></p>
<p>[TOC]</p>
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="http://logging.apache.org/log4j/2.x/manual/architecture.html" target="_blank" rel="noopener">Log4j2 Architecture</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dorgenjones.github.io/2017/03/12/%E5%9F%BA%E7%A1%80%E5%B7%A5%E5%85%B7/log/2.log4j2%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zamperini">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zamperini">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/12/%E5%9F%BA%E7%A1%80%E5%B7%A5%E5%85%B7/log/2.log4j2%E9%85%8D%E7%BD%AE/" itemprop="url">Log4j2é…ç½®æ–‡ä»¶&æè¿°</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-03-12T00:00:00+08:00">2017-03-12</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/log4j/" itemprop="url" rel="index"><span itemprop="name">log4j</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Log4j2-é…ç½®æ–‡ä»¶åŠæè¿°"><a href="#Log4j2-é…ç½®æ–‡ä»¶åŠæè¿°" class="headerlink" title="Log4j2 é…ç½®æ–‡ä»¶åŠæè¿°"></a>Log4j2 é…ç½®æ–‡ä»¶åŠæè¿°</h1><p>å‰é¢ä»‹ç»Java Logçš„æ€»ä½“æƒ…å†µï¼Œä»¥åŠä¸¤ä¸ªæ—¥å¿—æ¡†æ¶å’Œå…·ä½“æ—¥å¿—å®ç°æ¡†æ¶é—´çš„æ¡¥æ¥ã€‚æœ¬ç« ä¸»è¦ä»‹ç»æ—¥å¸¸å·¥ä½œä¸­ç”¨çš„æ¯”è¾ƒå¤šçš„Log4j2çš„é…ç½®ä¿¡æ¯ä»¥åŠè§£é‡Šã€‚</p>
<h2 id="1-é…ç½®æ–‡ä»¶è§£æ"><a href="#1-é…ç½®æ–‡ä»¶è§£æ" class="headerlink" title="1. é…ç½®æ–‡ä»¶è§£æ"></a>1. é…ç½®æ–‡ä»¶è§£æ</h2><h3 id="1-åŒæ­¥æ¨¡å¼"><a href="#1-åŒæ­¥æ¨¡å¼" class="headerlink" title="1. åŒæ­¥æ¨¡å¼"></a>1. åŒæ­¥æ¨¡å¼</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    å…¨å±€é…ç½®</span></span><br><span class="line"><span class="comment">    status : è¿™ä¸ªç”¨äºè®¾ç½®log4j2è‡ªèº«å†…éƒ¨çš„ä¿¡æ¯è¾“å‡º,å¯ä»¥ä¸è®¾ç½®,å½“è®¾ç½®æˆtraceæ—¶,ä¼šçœ‹åˆ°log4j2å†…éƒ¨å„ç§è¯¦ç»†è¾“å‡º</span></span><br><span class="line"><span class="comment">    monitorInterval : Log4jèƒ½å¤Ÿè‡ªåŠ¨æ£€æµ‹ä¿®æ”¹é…ç½®æ–‡ä»¶å’Œé‡æ–°é…ç½®æœ¬èº«, è®¾ç½®é—´éš”ç§’æ•°ã€‚</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">status</span>=<span class="string">"WARN"</span> <span class="attr">monitorInterval</span>=<span class="string">"1000"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Properties</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- é…ç½®æ—¥å¿—ç›®å½• --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Property</span> <span class="attr">name</span>=<span class="string">"LOG_HOME"</span>&gt;</span>./logs<span class="tag">&lt;/<span class="name">Property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Properties</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ—¥å¿—è¾“å‡ºåœ°å€--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--è¾“å‡ºæ§åˆ¶å°--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Console</span> <span class="attr">name</span>=<span class="string">"Console"</span> <span class="attr">target</span>=<span class="string">"SYSTEM_OUT"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- æ—¥å¿—æ ¼å¼ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"[%level][%date&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;][%thread][%class][%method][%line]:%message%n"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Console</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingRandomAccessFile</span> <span class="attr">name</span>=<span class="string">"infoLog"</span> <span class="attr">fileName</span>=<span class="string">"$&#123;LOG_HOME&#125;/info.log"</span></span></span><br><span class="line"><span class="tag">                                 <span class="attr">filePattern</span>=<span class="string">"$&#123;LOG_HOME&#125;/info.%d&#123;yyyy-MM-dd&#125;.log.gz"</span> <span class="attr">append</span>=<span class="string">"true"</span>&gt;</span><span class="comment">&lt;!--å‹ç¼©æ–‡ä»¶å--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"[%level][%date&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;][%thread][%class][%method][%line]:%message%n"</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">                 %c&#123;precision&#125; | %logger&#123;precision&#125; : name of the logger</span></span><br><span class="line"><span class="comment">                 %class&#123;precision&#125; | %C&#123;precision&#125;: class name of the caller</span></span><br><span class="line"><span class="comment">                 %date&#123;pattern&#125; | %d&#123;pattern&#125; :the date of the logging event</span></span><br><span class="line"><span class="comment">                 %L | %line:line number</span></span><br><span class="line"><span class="comment">                 %level : the level of the logging event</span></span><br><span class="line"><span class="comment">                 %m&#123;nolookups&#125;&#123;ansi&#125; | %msg&#123;nolookups&#125;&#123;ansi&#125; | %message&#123;nolookups&#125;&#123;ansi&#125;:application supplied message</span></span><br><span class="line"><span class="comment">                 %method | %M: method name where the logging request</span></span><br><span class="line"><span class="comment">                 %t | %tn | %thread | %threadName :name of the thread</span></span><br><span class="line"><span class="comment">                 %n :</span></span><br><span class="line"><span class="comment">             --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Filters</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">"error"</span> <span class="attr">onMatch</span>=<span class="string">"DENY"</span> <span class="attr">onMismatch</span>=<span class="string">"NEUTRAL"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">"warn"</span> <span class="attr">onMatch</span>=<span class="string">"DENY"</span> <span class="attr">onMismatch</span>=<span class="string">"NEUTRAL"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">"info"</span> <span class="attr">onMatch</span>=<span class="string">"ACCEPT"</span> <span class="attr">onMismatch</span>=<span class="string">"DENY"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">"debug"</span> <span class="attr">onMatch</span>=<span class="string">"ACCEPT"</span> <span class="attr">onMismatch</span>=<span class="string">"DENY"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Filters</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">                     TimeBased Triggering Policy: The policy to use to determine if a rollover should occur.</span></span><br><span class="line"><span class="comment">                    intervalå•ä½ä¸filePatternç›¸å…³ yyyy-MM-dd ä¸€å¤©ä¸€ä¸ªæ–‡ä»¶, yyyy-MM-dd-HH æ¯å°æ—¶ä¸€ä¸ªæ–‡ä»¶</span></span><br><span class="line"><span class="comment">                    åŸºäºæ—¶é—´çš„è§¦å‘ç­–ç•¥ã€‚è¯¥ç­–ç•¥ä¸»è¦æ˜¯å®Œæˆå‘¨æœŸæ€§çš„logæ–‡ä»¶å°å­˜å·¥ä½œã€‚æœ‰ä¸¤ä¸ªå‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">                    intervalï¼Œintegerå‹ï¼ŒæŒ‡å®šä¸¤æ¬¡å°å­˜åŠ¨ä½œä¹‹é—´çš„æ—¶é—´é—´éš”ã€‚å•ä½:ä»¥æ—¥å¿—çš„å‘½åç²¾åº¦æ¥ç¡®å®šå•ä½</span></span><br><span class="line"><span class="comment">                    modulateï¼Œbooleanå‹ï¼Œè¯´æ˜æ˜¯å¦å¯¹å°å­˜æ—¶é—´è¿›è¡Œè°ƒåˆ¶ã€‚è‹¥modulate=trueï¼Œåˆ™å°å­˜æ—¶é—´å°†ä»¥0ç‚¹ä¸ºè¾¹ç•Œè¿›è¡Œåç§»è®¡ç®—ã€‚</span></span><br><span class="line"><span class="comment">                --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">"100 MB"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingRandomAccessFile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingRandomAccessFile</span> <span class="attr">name</span>=<span class="string">"errorLog"</span> <span class="attr">fileName</span>=<span class="string">"$&#123;LOG_HOME&#125;/error.log"</span></span></span><br><span class="line"><span class="tag">                                 <span class="attr">filePattern</span>=<span class="string">"$&#123;LOG_HOME&#125;/error.%d&#123;yyyy-MM-dd&#125;.log.gz"</span> <span class="attr">append</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Filters</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">"ERROR"</span> <span class="attr">onMatch</span>=<span class="string">"ACCEPT"</span> <span class="attr">onMismatch</span>=<span class="string">"DENY"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Filters</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"[%level][%date&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;][%thread][%class][%method][%line]:%message%n"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> <span class="attr">interval</span>=<span class="string">"1"</span> <span class="attr">modulate</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingRandomAccessFile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--æ—¥å¿—é…ç½®--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"experiment"</span> <span class="attr">level</span>=<span class="string">"info"</span> <span class="attr">additivity</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"infoLog"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"errorLog"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"Console"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"experiment.test"</span> <span class="attr">level</span>=<span class="string">"warn"</span> <span class="attr">additivity</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"infoLog"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"errorLog"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"Console"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"algorithm"</span> <span class="attr">level</span>=<span class="string">"info"</span> <span class="attr">additivity</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"infoLog"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">"Console"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- é…ç½®æ—¥å¿—çš„æ ¹èŠ‚ç‚¹ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Root</span> <span class="attr">level</span>=<span class="string">"warn"</span> <span class="attr">includeLocation</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">"errorLog"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">"Console"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-å…¨å¼‚æ­¥æ¨¡å¼"><a href="#2-å…¨å¼‚æ­¥æ¨¡å¼" class="headerlink" title="2. å…¨å¼‚æ­¥æ¨¡å¼"></a>2. å…¨å¼‚æ­¥æ¨¡å¼</h3><ol>
<li>åªéœ€è¦å°†<strong>ç³»ç»Ÿå±æ€§</strong><code>Log4jContextSelector</code>è®¾ç½®ä¸º<code>AsyncLoggerContextSelector</code></li>
<li>åœ¨é…ç½®å±æ€§æ–‡ä»¶<code>log4j2.component.properties</code>ä¸­é…ç½®<code>Log4jContextSelector</code>ä¸º<code>AsyncLoggerContextSelector</code></li>
</ol>
<h3 id="3-æ··åˆæ¨¡å¼"><a href="#3-æ··åˆæ¨¡å¼" class="headerlink" title="3.æ··åˆæ¨¡å¼"></a>3.æ··åˆæ¨¡å¼</h3><p>todo ä¿®æ”¹<br>ä¸éœ€è¦æ”¹ç³»ç»Ÿå±æ€§æˆ–è€…å¼•å…¥å±æ€§é…ç½®æ–‡ä»¶ï¼Œåªéœ€è¦å°†ç›¸åº”çš„<code>Loger</code>æ¢æˆ<code>AsyncLoger</code>ã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">logers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">AsyncLogger</span> <span class="attr">name</span>=<span class="string">"experiment.test"</span> <span class="attr">level</span>=<span class="string">"trace"</span> <span class="attr">includeLocation</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">"warnLog"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">AsyncLogger</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">logers</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>##2. åŒæ­¥ã€å¼‚æ­¥ä»¥åŠæ··åˆæ¨¡å¼çš„æ¯”è¾ƒ<br>è™½ç„¶å¼‚æ­¥æ—¥å¿—æœ‰å¾ˆå¤§çš„ä¼˜åŠ¿ï¼Œä½†æ˜¯å®ƒå¹¶ä¸æ˜¯é€‚åˆäºæ‰€æœ‰åº”ç”¨åœºæ™¯ã€‚å¦‚ä¸‹å°†é€šè¿‡åˆ†æå¼‚æ­¥æ—¥å¿—çš„ä¼˜åŠ£æ¥æ¯”è¾ƒåŒæ­¥æ—¥å¿—å’Œå¼‚æ­¥æ—¥å¿—ï¼š</p>
<ol>
<li><p>ä¼˜åŠ¿</p>
<ul>
<li>æ›´é«˜çš„å³°å€¼ååé‡ï¼Œç›¸åŒåœºæ™¯ä¸‹ï¼Œå¼‚æ­¥æ—¥å¿—çš„èƒ½æ‰“å°çš„æ—¥å¿—é‡æ˜¯åŒæ­¥çš„6-58å€</li>
<li>æ›´å¿«çš„å“åº”æ—¶é—´ï¼Œè°ƒç”¨åç«‹å³è¿”å›ï¼Œè€Œä¸ç”¨ç­‰åˆ°appenderæ‰§è¡Œå®Œæˆã€‚</li>
</ul>
</li>
<li><p>ç¼ºç‚¹</p>
<ul>
<li>é”™è¯¯å¤„ç†æ–¹ä¾¿ï¼Œå¦‚æœåœ¨æ‰“å°æ—¥å¿—çš„è¿‡ç¨‹ä¸­æŠ›äº†å¼‚å¸¸ï¼Œå¯¹äºå¼‚æ­¥æ—¥å¿—æ¥è¯´å¾ˆéš¾è®°å½•ã€‚å³ä½¿é€šè¿‡ExceptionHanderå¯ä»¥å‡è½»è¿™ç§æƒ…å†µï¼Œä½†æ˜¯å¹¶ä¸èƒ½è§£å†³æ‰€æœ‰çš„æƒ…å†µã€‚å› æ­¤ï¼Œå½“æ—¥å¿—æ˜¯ä¸šåŠ¡é€»è¾‘çš„ä¸€éƒ¨åˆ†ï¼ˆæ¯”å¦‚è®²Log4jä½œä¸ºå®¡è®¡æ—¥å¿—æ¡†æ¶ï¼‰æ—¶ï¼Œåˆ™æ¨èä½¿ç”¨åŒæ­¥æ—¥å¿—ï¼›</li>
<li>åœ¨æŸäº›æç«¯çš„æƒ…å†µä¸‹ï¼Œæ‰“å°çš„æ—¥å¿—å¯¹è±¡ï¼Œå¯èƒ½ä¼šæœ‰å˜åŒ–ã€‚å¦‚ï¼š<code>MapMessage</code>ã€<code>StructuredDataMessage</code>ï¼Œç”¨æˆ·æœ‰å¯èƒ½ä¼šçœ‹åˆ°éè§¦å‘æ‰“å°æ—¶çš„å¯¹è±¡å¿«ç…§</li>
<li>å¦‚æœåº”ç”¨CPUèµ„æºåƒç´§çš„è¯ï¼Œä¸é€‚åˆäºå¼‚æ­¥ã€‚å› ä¸ºå®ƒçš„é€Ÿåº¦æ˜¯ä»¥ç‰ºç‰²CPUä¸ºä»£ä»·çš„ã€‚</li>
<li>å½“åº”ç”¨æ‰“æ—¥å¿—çš„é€Ÿç‡æ¯”åº•å±‚è¿½åŠ å™¨çš„æœ€å¤§é€Ÿç‡éƒ½è¦å¿«ï¼Œæœ€åé˜Ÿåˆ—ä¼šè¢«æ‰“æ»¡ï¼Œæœ€ç»ˆä¹Ÿä¼šä»¥æœ€æ…¢è¿½åŠ å™¨çš„é€Ÿç‡æ‰“æ—¥å¿—</li>
</ul>
</li>
</ol>
<h3 id="ä¸»è¦å·¥ä½œæµç¨‹ï¼š"><a href="#ä¸»è¦å·¥ä½œæµç¨‹ï¼š" class="headerlink" title="ä¸»è¦å·¥ä½œæµç¨‹ï¼š"></a>ä¸»è¦å·¥ä½œæµç¨‹ï¼š</h3><ol>
<li>LogManager.getLogger(xx.class) ä¼šæ ¹æ®classæ–‡ä»¶çš„å…·ä½“ç±»åæ¥è·å–æœ€åŒ¹é…çš„LogConfig</li>
<li>ä¼šéå†æ‰€æœ‰Appenderï¼Œæ‰“å°æ—¥å¿—ï¼›</li>
<li>å½“LoggerConfigé…ç½®äº†additivity=â€trueâ€ ä¼šå°†æ—¥å¿—äº‹ä»¶ä¼ é€’ç»™çˆ¶èŠ‚ç‚¹LoggerConfig</li>
</ol>
<p>LogerConfigä¼šæ ¹æ®nameæ¥å»ºç«‹ä¸€ä¸ªå…³ç³»æ ‘ï¼Œrootæ˜¯æ ¹èŠ‚ç‚¹ã€‚å¦‚ä¸‹å›¾ï¼š<br>additivityï¼ˆæ˜¯å¦å¯å åŠ ï¼‰ ç”¨äºæ§åˆ¶ï¼šå­LogConfigé‡Œçš„æ—¥å¿—äº‹ä»¶æ˜¯å¦å¾€çˆ¶LogConfigä¸­ä¼ é€’ã€‚</p>
<h2 id="3-LogConfigç»§æ‰¿å…³ç³»å›¾"><a href="#3-LogConfigç»§æ‰¿å…³ç³»å›¾" class="headerlink" title="3. LogConfigç»§æ‰¿å…³ç³»å›¾"></a>3. LogConfigç»§æ‰¿å…³ç³»å›¾</h2><p><img src="/media/14931361439660.jpg" alt="set up-w400"></p>
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="http://logging.apache.org/log4j/2.x/manual/layouts.html" target="_blank" rel="noopener">Layouts</a></li>
<li><a href="http://logging.apache.org/log4j/2.x/manual/appenders.html" target="_blank" rel="noopener">Appenders</a></li>
<li><a href="http://blog.csdn.net/jiangguilong2000/article/details/11397557" target="_blank" rel="noopener">Log4j2ä½¿ç”¨æ€»ç»“</a></li>
<li><a href="http://mp.weixin.qq.com/s?__biz=MjM5NzMyMjAwMA==&mid=2651477099&idx=2&sn=1e06a34aaa899ceef8bf380bb98f813f&scene=0#wechat_redirect" target="_blank" rel="noopener">Log4jæ¶æ„è§£æ</a></li>
<li><a href="http://ifeve.com/disruptor/" target="_blank" rel="noopener">å¹¶å‘æ¡†æ¶Disruptor</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dorgenjones.github.io/2017/03/11/%E5%9F%BA%E7%A1%80%E5%B7%A5%E5%85%B7/log/1.java%20log%E7%AE%80%E4%BB%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zamperini">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zamperini">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/11/%E5%9F%BA%E7%A1%80%E5%B7%A5%E5%85%B7/log/1.java%20log%E7%AE%80%E4%BB%8B/" itemprop="url">Java Logç®€ä»‹</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-03-11T00:00:00+08:00">2017-03-11</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/log4j/" itemprop="url" rel="index"><span itemprop="name">log4j</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Java-Log-ç®€ä»‹"><a href="#Java-Log-ç®€ä»‹" class="headerlink" title="Java Log ç®€ä»‹"></a>Java Log ç®€ä»‹</h1><p>[TOC]</p>
<h2 id="åˆè¡·åŠç›®çš„"><a href="#åˆè¡·åŠç›®çš„" class="headerlink" title="åˆè¡·åŠç›®çš„"></a>åˆè¡·åŠç›®çš„</h2><h3 id="åˆè¡·"><a href="#åˆè¡·" class="headerlink" title="åˆè¡·"></a>åˆè¡·</h3><p>ä¸ºä»€ä¹ˆé¡¹ç›®é‡Œä¼šå¼•å…¥è¿™ä¹ˆå¤šå…³äºlogçš„jaråŒ…ï¼Ÿ<br>éƒ½æ˜¯å¹²å˜›åƒçš„ï¼Ÿ<br>æ—¥å¿—åœˆçœŸ<strong>ä¹±</strong>ï¼ï¼ï¼</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">commons-logging-1.2.jar</span><br><span class="line">log4j-1.2.17.jar</span><br><span class="line">log4j-1.2-api-2.3.jar</span><br><span class="line">log4j-api-2.1.jar</span><br><span class="line">log4j-core-2.1.jar</span><br><span class="line">log4j-over-slf4j-1.7.7.jar</span><br><span class="line">log4j-slf4j-impl-2.1.jar</span><br><span class="line">jcl-over-slf4j-1.7.7.jar</span><br><span class="line">jul-to-slf4j-1.7.7.jar</span><br><span class="line">slf4j-api-1.7.7.jar</span><br></pre></td></tr></table></figure>

<h3 id="ç›®çš„"><a href="#ç›®çš„" class="headerlink" title="ç›®çš„"></a>ç›®çš„</h3><ol>
<li>ä»‹ç»javaæ—¥å¿—ä½“ç³»çš„è„‰ç»œå’Œå…³ç³»</li>
<li>é‡ç‚¹ä»‹ç»Log4j2çš„é…ç½®</li>
<li>Log4j2çš„åŸç†æµ…æ</li>
</ol>
<p>Javaæ—¥å¿—ä½“ç³»åˆ†ä¸ºæ—¥å¿—é—¨é¢å’Œæ—¥å¿—å®ç°ã€‚ä¸‹é¢å°†åˆ†åˆ«ä»‹ç»å®ƒä»¬ã€‚</p>
<h2 id="æ—¥å¿—é—¨é¢"><a href="#æ—¥å¿—é—¨é¢" class="headerlink" title="æ—¥å¿—é—¨é¢"></a>æ—¥å¿—é—¨é¢</h2><ul>
<li><strong>ä»£ç†ç³»ç»Ÿ</strong>ï¼Œè‡ªèº«ä¸å®ç°å…·ä½“çš„æ—¥å¿—æ‰“å°é€»è¾‘ã€‚æ¥å—æ—¥å¿—è¯·æ±‚ï¼Œå°†çœŸæ­£çš„æ‰“å°é€»è¾‘äº¤ç»™å…·ä½“çš„æ—¥å¿—å®ç°ç³»ç»Ÿã€‚</li>
<li><strong>å¯æ’æ‹”</strong>ï¼Œä¸šåŠ¡å¯ä»¥é€šè¿‡é…ç½®æˆ–è€…åŠ å…¥ä¸€äº›jaråŒ…çš„æ–¹å¼åˆ‡æ¢åˆ°å…¶ä»–æ—¥å¿—å®ç°æ¡†æ¶ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹ä»£ç é€»è¾‘ï¼Œ<strong>è§£è€¦</strong>ã€‚</li>
</ul>
<p>ç›®å‰ä¸»è¦æœ‰ä¸¤å¥—é€šç”¨æ—¥å¿—é—¨é¢ï¼šcommon-loggingã€slf4jã€‚</p>
<p>###1. <a href="https://commons.apache.org/proper/commons-logging/" target="_blank" rel="noopener">common-loggingï¼šApache Commons Logging</a><br>ä½¿ç”¨æ–¹å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Log log = LogFactory.getLog(xx<span class="class">.<span class="keyword">class</span>)</span>;</span><br></pre></td></tr></table></figure>
<p>ç‰¹ç‚¹ï¼š</p>
<ol>
<li>ç®€å•ã€éå¸¸è½»çš„ä¸€ç§æ¡¥æ¥ï¼ˆ<strong>åŠ¨æ€æŸ¥æ‰¾</strong>ï¼‰æ–¹å¼ã€‚</li>
<li>é™åˆ¶ï¼šä¸æ”¯æŒOSGIï¼Œæ¨¡å—åŒ–åº”ç”¨</li>
<li>åŠŸèƒ½å•ä¸€ï¼šåªèƒ½æ”¯æŒåˆ°å…·ä½“æ—¥å¿—ç³»ç»Ÿé—´çš„æ¡¥æ¥ï¼Œè€Œä¸èƒ½æ”¯æŒä»å…·ä½“æ—¥å¿—ç³»ç»Ÿåˆ°å…¶è‡ªèº«çš„æ¡¥æ¥ã€‚</li>
</ol>
<p>###2. <a href="https://www.slf4j.org/" target="_blank" rel="noopener">SLF4Jï¼šSimple Logging Facade for JAVA</a><br>ä½¿ç”¨æ–¹å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Logger logger &#x3D; LoggerFactory.getLogger(xx.class);</span><br></pre></td></tr></table></figure>
<p>ç‰¹ç‚¹ï¼š</p>
<ol>
<li>åŠŸèƒ½å¼ºå¤§ï¼Œä¸ä»…æ”¯æŒåˆ°å…·ä½“æ—¥å¿—å®ç°ä¹‹é—´çš„æ¡¥æ¥ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒä»å…·ä½“æ—¥å¿—ç³»ç»Ÿåˆ°è‡ªèº«çš„æ¡¥æ¥</li>
<li>æ”¯æŒOSGIæ¨¡å—åŒ–åº”ç”¨</li>
<li>é€šè¿‡<strong>é™æ€ç»‘å®š</strong>çš„æ¡¥æ¥æ–¹å¼</li>
</ol>
<h2 id="æ—¥å¿—å®ç°"><a href="#æ—¥å¿—å®ç°" class="headerlink" title="æ—¥å¿—å®ç°"></a>æ—¥å¿—å®ç°</h2><p>###1. <a href="http://docs.oracle.com/javase/8/docs/technotes/guides/logging/" target="_blank" rel="noopener">Jdk-logging</a><br>JDKè‡ªå¸¦çš„ä¸€ç§è‡ªå®šä¹‰çš„ã€å¯æ‰©å±•çš„æ—¥å¿—æ¡†æ¶ï¼ˆjava.util.logging)ã€‚ä½†æ˜¯å…¶APIå¹¶ä¸å®Œå–„ï¼Œä¸æ˜¯å¾ˆå¾ˆå‹å¥½ï¼Œè€Œä¸”å¯¹äºæ—¥å¿—çš„çº§åˆ«åˆ†ç±»ä¹Ÿä¸æ˜¯å¾ˆæ¸…æ™°<br>    <a href="http://blog.csdn.net/qingkangxu/article/details/7514770" target="_blank" rel="noopener">JDK Loggingæ·±å…¥åˆ†æ</a></p>
<p>###2. <a href="http://logging.apache.org/log4j/1.2/" target="_blank" rel="noopener">Log4j1</a><br>Log4jä¹Ÿæ˜¯Apacheçš„å¼€æºé¡¹ç›®ï¼Œæœ€æ—©è¢«å¹¿æ³›åº”ç”¨çš„æ—¥å¿—è§£å†³æ–¹æ¡ˆã€‚</p>
<blockquote>
</blockquote>
<ol>
<li>æ—¥å¿—è¾“å‡ºç›®çš„åœ°å¯æ§ï¼›</li>
<li>è¾“å‡ºæ ¼å¼å¯æ§ï¼›</li>
<li>é€šè¿‡æ—¥å¿—çº§åˆ«ï¼Œæ›´ç»†è‡´æ§åˆ¶æ—¥å¿—çš„ç”Ÿæˆè¿‡ç¨‹</li>
<li>é€šè¿‡é…ç½®æ–‡ä»¶æ¥çµæ´»åœ°è¿›è¡Œé…ç½®æ—¥å¿—è¾“å‡ºï¼Œè€Œä¸éœ€è¦ä¿®æ”¹ç¨‹åºä»£ç ã€‚</li>
</ol>
<blockquote>
<p>1.xç³»åˆ—åœ¨15å¹´8æœˆè¢«Apacheå®£å¸ƒåœæ­¢ç»´æŠ¤ï¼ˆ<a href="https://blogs.apache.org/foundation/entry/apache_logging_services_project_announces" target="_blank" rel="noopener">Apache Blog</a>ï¼‰</p>
</blockquote>
<p>###3. <a href="https://logback.qos.ch/" target="_blank" rel="noopener">LogBack</a><br>ä¹Ÿæ˜¯å‡ºè‡ªLog4jçš„åˆ›å§‹äººï¼Œæœ€åˆçš„æ„å›¾æ˜¯ç”¨æ¥æ›¿ä»£Log4jã€‚åœ¨æ—¥å¿—æ€§èƒ½ã€åŠŸèƒ½ã€å¯ç”¨æ€§ä¸Šæœ‰äº†å¾ˆå¤§ç¨‹åº¦çš„æå‡ï¼š <a href="https://logback.qos.ch/reasonsToSwitch.html" target="_blank" rel="noopener">Reasons to prefer logback over log4j</a></p>
<blockquote>
<p>Logbackå½“å‰åˆ†ä¸ºä¸‰ä¸ªæ¨¡å—ï¼šlogback-core, logback-classic and logback-accessï¼›<br><strong>logback-core</strong>æ¨¡å—æ˜¯å…¶ä»–ä¸¤ä¸ªæ¨¡å—çš„åŸºçŸ³ï¼›<br><strong>logback-classic</strong>æ˜¯log4jçš„æ”¹è‰¯ç‰ˆï¼Œåˆ«å¤–ï¼Œå…¶ä¹Ÿå®ç°äº†SLF4J APIï¼Œä½¿å…¶å¯ä»¥ä¾¿æ·åœ°æ›´æ¢å…¶ä»–æ—¥å¿—å®ç°ç³»ç»Ÿ<br> <strong>logback-access</strong>ä¸Servletå®¹å™¨é›†æˆï¼Œæä¾›é€šè¿‡Httpæ¥è®¿é—®æ—¥å¿—çš„åŠŸèƒ½</p>
</blockquote>
<p>###4. <a href="http://logging.apache.org/log4j/2.x/index.html" target="_blank" rel="noopener">Log4j2</a><br>Log4j2ä¹Ÿæ˜¯Apacheçš„å¼€æºé¡¹ç›®ï¼Œå®ƒå¯¹Log4j1åšäº†å·¨å¤§çš„æå‡ã€‚å¹¶ä¸”ä¹Ÿæä¾›äº†å¾ˆå¤šLogbackçš„æ”¹è¿›ï¼Œå¹¶ä¸”æ”¹è¿›äº†Logbackæ¡†æ¶å­˜åœ¨çš„ä¸€äº›é—®é¢˜ã€‚</p>
<blockquote>
<ol>
<li><strong>æ€§èƒ½æå‡</strong>:åŒ…å«ä¸‹ä¸€ä»£åŸºäºthe LMAX Disruptor libraryçš„å¼‚æ­¥æ—¥å¿—æ¡†æ¶ã€‚å¤šçº¿ç¨‹åœºæ™¯ä¸‹ï¼Œååé‡æ˜¯ Log4j1å’ŒLogbackçš„18å€,å“åº”æ—¶é—´ä¹Ÿæ¯”å®ƒä»¬å°å¾ˆå¤šã€‚æ€§èƒ½æŠ¥å‘Šï¼š<a href="http://logging.apache.org/log4j/2.x/performance.html" target="_blank" rel="noopener">http://logging.apache.org/log4j/2.x/performance.html</a></li>
<li><strong>æ’ä»¶å¼ç»“æ„</strong>:å¯ä»¥æ ¹æ®éœ€è¦æ‰©å±•Log4j2. å¯ä»¥å®ç°Appenderã€Loggerã€Filter</li>
<li><strong>åŠ¨æ€åŠ è½½é…ç½®</strong>:å¯ä»¥åŠ¨æ€åœ°åŠ è½½ä¿®æ”¹çš„é…ç½®ï¼Œå¹¶ä¸”åœ¨é‡é…ç½®æ—¶ï¼Œä¸ä¼šä¸¢å¤±æ—¥å¿—æ—¶é—´</li>
<li><strong>æ”¯æŒå¤šç§API</strong>ï¼ŒLog4j2è‡ªå·±å®ç°äº†Log4j1ã€Common-loggingã€Slf4jçš„æ¡¥æ¥(log4j-1.2-apiã€log4j-jclã€log4j-slf4j-impl)<br>â€¦</li>
</ol>
</blockquote>
<h2 id="æ¡¥æ¥"><a href="#æ¡¥æ¥" class="headerlink" title="æ¡¥æ¥"></a>æ¡¥æ¥</h2><p>æ—¥å¿—é—¨é¢é€šè¿‡ä»€ä¹ˆæ–¹æ³•ä¸å…·ä½“çš„æ—¥å¿—å®ç°è¿›è¡Œç»‘å®šã€‚</p>
<h3 id="1-Common-logging-æ¡¥æ¥"><a href="#1-Common-logging-æ¡¥æ¥" class="headerlink" title="1.Common-logging æ¡¥æ¥"></a>1.Common-logging æ¡¥æ¥</h3><p>å…¶é€šè¿‡<strong>åŠ¨æ€æŸ¥æ‰¾</strong>çš„æœºåˆ¶ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶è‡ªåŠ¨æ‰¾å‡ºçœŸæ­£ä½¿ç”¨çš„æ—¥å¿—åº“ã€‚ä¹Ÿæ˜¯æ¯”è¾ƒç²—ç•¥çš„ä¸€ç§æ–¹å¼<br>å…¶è¿è¡ŒåŸç†ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Log log = LogFactory.getLog(xx<span class="class">.<span class="keyword">class</span>)</span>;</span><br></pre></td></tr></table></figure>
<p>å…¶é¦–å…ˆè·å–ä¸€ä¸ªæ—¥å¿—å¯¹è±¡çš„å·¥å‚ï¼Œç„¶åé€šè¿‡å·¥å‚æ¥ç”Ÿæˆå¯¹è±¡</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> getFactory().getInstance(clazz);</span><br></pre></td></tr></table></figure>
<p>getFactory()æ–¹æ³•ä¸­å±•ç¤ºäº†æ—¥å¿—å·¥å‚çš„é€»è¾‘ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.å…¨å±€ç³»ç»Ÿå˜é‡ä¸­å¯»æ‰¾ org.apache.commons.logging.LogFactory</span></span><br><span class="line"> String factoryClass = getSystemProperty(FACTORY_PROPERTY, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//2. æ‰¾ META-INF/services/org.apache.commons.logging.LogFactory æ–‡ä»¶ä¸­å®šä¹‰çš„LogFactoryåç§°ï¼Œ</span></span><br><span class="line"><span class="comment">// log4j2çš„æ¡¥æ¥å°±æä¾›äº†è¿™æ ·çš„æ–‡ä»¶</span></span><br><span class="line"> <span class="keyword">final</span> InputStream is = getResourceAsStream(contextClassLoader, SERVICE_ID);</span><br><span class="line"> <span class="keyword">if</span>( is != <span class="keyword">null</span> ) &#123;</span><br><span class="line">     BufferedReader rd;</span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">         rd = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(is, <span class="string">"UTF-8"</span>));</span><br><span class="line">     &#125; <span class="keyword">catch</span> (java.io.UnsupportedEncodingException e) &#123;</span><br><span class="line">         rd = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(is));</span><br><span class="line">     &#125;</span><br><span class="line">     String factoryClassName;</span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">         factoryClassName = rd.readLine();</span><br><span class="line">     &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">         rd.close();</span><br><span class="line">     &#125;</span><br><span class="line">     factory = newFactory(factoryClassName, baseClassLoader, contextClassLoader);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.æ‰¾ç”¨æˆ·é…ç½®çš„å±æ€§æ–‡ä»¶ä¸­keyä¸ºorg.apache.commons.logging.LogFactoryçš„é…ç½®å€¼ä½œä¸ºæ—¥å¿—å·¥å‚               </span></span><br><span class="line"> String factoryClass = props.getProperty(FACTORY_PROPERTY);</span><br><span class="line"> <span class="keyword">if</span> (factoryClass != <span class="keyword">null</span>) &#123;</span><br><span class="line">     factory = newFactory(factoryClass, baseClassLoader, contextClassLoader);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. é»˜è®¤çš„æ—¥å¿—å·¥å‚ org.apache.commons.logging.impl.LogFactoryImpl               </span></span><br><span class="line">factory = newFactory(FACTORY_DEFAULT, thisClassLoader, contextClassLoader);</span><br></pre></td></tr></table></figure>

<p>è·å–å·¥å‚å¯¹è±¡åï¼Œå°±ç”±å·¥å‚å¯¹è±¡è·Ÿæ®ç›¸åº”çš„é…ç½®æ¥ç”Ÿæˆæ—¥å¿—å¯¹è±¡ã€‚ä»¥é»˜è®¤çš„å·¥å‚ç±»LogFactoryImplä¸ºä¾‹ï¼Œæˆ‘ä»¬æ¥åˆ†æç”Ÿæˆæ—¥å¿—å¯¹è±¡çš„è¿‡ç¨‹ï¼š<br>å…¶æ ¸å¿ƒä»£ç åœ¨discoverLogImplementation(String logCategory)æ–¹æ³•ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.é¦–å…ˆ åˆ¤æ–­ç”¨æˆ·æ˜¯å¦è‡ªå®šä¹‰äº†æ—¥å¿—å®ç°ç±» org.apache.commons.logging.Logã€org.apache.commons.logging.log ä¸ºkeyçš„ç”¨æˆ·é…ç½®æ–‡ä»¶é¡¹æˆ–ç³»ç»Ÿå±æ€§</span></span><br><span class="line">String specifiedLogClassName = findUserSpecifiedLogClassName();</span><br><span class="line"><span class="comment">//2. å¦‚æœæ²¡æœ‰ï¼Œå°±æŒ‰ä»¥ä¸‹é¡ºåºå»å°è¯•åˆ›å»ºæ—¥å¿—å¯¹è±¡ï¼Œåˆ›å»ºæˆåŠŸåç«‹å³è¿”å›ç›¸åº”æ—¥å¿—å¯¹è±¡</span></span><br><span class="line"><span class="string">"org.apache.commons.logging.impl.Log4JLogger"</span>,</span><br><span class="line"><span class="string">"org.apache.commons.logging.impl.Jdk14Logger"</span>,</span><br><span class="line"><span class="string">"org.apache.commons.logging.impl.Jdk13LumberjackLogger"</span>,</span><br><span class="line"><span class="string">"org.apache.commons.logging.impl.SimpleLog"</span></span><br></pre></td></tr></table></figure>
<p>æ€»ç»“ï¼š</p>
<ol>
<li>é¦–å…ˆ<strong>å¯»æ‰¾æ—¥å¿—å·¥å‚ç±»</strong>ï¼š<br>é€šè¿‡æ£€æŸ¥ç³»ç»Ÿå±æ€§ã€æ‰§è¡Œè·¯å¾„æ–‡ä»¶å’Œç”¨æˆ·é…ç½®æ–‡ä»¶ï¼Œçœ‹æ˜¯å¦å®šä¹‰äº†ç›¸åº”çš„æ—¥å¿—å·¥ç¨‹ç±»ã€‚è‹¥æœ‰åˆ™åŠ è½½æ­¤ç±»ï¼Œå¹¶é€šè¿‡å…¶æ¥ç”Ÿæˆæ—¥å¿—å¯¹è±¡ï¼›å¦åˆ™é€‰æ‹©é»˜è®¤çš„æ—¥å¿—å·¥å‚ï¼š<code>org.apache.commons.logging.impl.LogFactoryImpl</code></li>
<li>é»˜è®¤æ—¥å¿—å·¥å‚è·å–æ—¥å¿—é€‚é…å™¨çš„è¿‡ç¨‹ï¼šé¦–å…ˆå»å¯»æ‰¾ç”¨æˆ·æ˜¯å¦è‡ªå·±é…ç½®äº†æ—¥å¿—é€‚é…å™¨ã€‚è‹¥æœ‰åˆ™åŠ è½½æ­¤ç±»å¹¶åˆå§‹åŒ–è¿”å›ï¼›è‹¥æ²¡æœ‰ï¼Œåˆ™æŒ‰ä¸€ä¸ªå›ºå®šçš„é¡ºåºæ¥å°è¯•æ¥å®ä¾‹åŒ–æ—¥å¿—é€‚é…å™¨ï¼Œè‹¥å®ä¾‹åŒ–æˆåŠŸåˆ™è¿”å›ã€‚</li>
</ol>
<h3 id="2-SLF4J-æ¡¥æ¥"><a href="#2-SLF4J-æ¡¥æ¥" class="headerlink" title="2. SLF4J æ¡¥æ¥"></a>2. SLF4J æ¡¥æ¥</h3><p>ä¸‹å›¾å±•ç¤ºçš„æ˜¯SLF4Jå’Œå…¶ä»–å®ç°æ—¥å¿—æ¡†æ¶çš„æ¡¥æ¥ç¤ºæ„å›¾ï¼š<br>å¯ä»¥çœ‹åˆ°é€šè¿‡jaråŒ…å’Œå…¶ä»–æ—¥å¿—å®ç°æ¡†æ¶èµ·æ¡¥æ¢ä½œç”¨ã€‚è¿™äº›èµ·æ¡¥æ¥ä½œç”¨çš„jaråŒ…æ˜¯æ€ä¹ˆèµ·ä½œç”¨çš„å‘¢ï¼Ÿ<br><img src="/media/14928715112128.jpg" alt="set up-w520"></p>
<p>æ˜¯å› ä¸º<code>StaticLoggerBinder</code>çš„ä½œç”¨ï¼<br>ä»SLF4Jçš„å…¥å£æ¥å¯»æ‰¾ç­”æ¡ˆï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Logger <span class="title">getLogger</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//è·å–æ—¥å¿—å·¥å‚</span></span><br><span class="line">   ILoggerFactory iLoggerFactory = getILoggerFactory();</span><br><span class="line">   <span class="keyword">return</span> iLoggerFactory.getLogger(name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ILoggerFactory <span class="title">getILoggerFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   ...</span><br><span class="line">    <span class="comment">//åŠ è½½StaticLoggerBinderç±»</span></span><br><span class="line">    performInitialization();</span><br><span class="line">   ...</span><br><span class="line">           <span class="comment">//åˆå§‹åŒ–StaticLoggerBinderï¼Œå¹¶è·å–å…¶åˆå§‹åŒ–çš„æ—¥å¿—å·¥å‚</span></span><br><span class="line">           <span class="keyword">return</span> StaticLoggerBinder.getSingleton().getLoggerFactory();</span><br><span class="line">           ...</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>performInitialization åˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿï¼Œ é€šè¿‡åŠ è½½é¡¹ç›®ä¸­å¼•å…¥çš„æ¡¥æ¥jaråŒ…ä¸­çš„StaticLoggerBinderï¼Œç»‘å®šç‰¹å®šæ—¥å¿—å®ç°æ¡†æ¶çš„ä½œç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">performInitialization</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//ç»‘å®šæ“ä½œ</span></span><br><span class="line">   bind();</span><br><span class="line">   ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bind</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">       Set&lt;URL&gt; staticLoggerBinderPathSet = <span class="keyword">null</span>;</span><br><span class="line">       <span class="keyword">if</span> (!isAndroid()) &#123;</span><br><span class="line">       <span class="comment">//è·å–é¡¹ç›®ä¸­æ‰€æœ‰çš„â€œorg/slf4j/impl/StaticLoggerBinder.classâ€æ–‡ä»¶</span></span><br><span class="line">           staticLoggerBinderPathSet = findPossibleStaticLoggerBinderPathSet();</span><br><span class="line">           <span class="comment">//å½“æ£€æµ‹åˆ°æœ‰å¤šä¸ªStaticLoggerBinderï¼Œä¼šå‘å‡ºè­¦å‘Šä¿¡æ¯</span></span><br><span class="line">           reportMultipleBindingAmbiguity(staticLoggerBinderPathSet);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">// å®ç°ç»‘å®š</span></span><br><span class="line">       StaticLoggerBinder.getSingleton();</span><br><span class="line">       INITIALIZATION_STATE = SUCCESSFUL_INITIALIZATION;</span><br><span class="line">       reportActualBinding(staticLoggerBinderPathSet);</span><br><span class="line">       fixSubstituteLoggers();</span><br><span class="line">       replayEvents();</span><br><span class="line">       <span class="comment">// release all resources in SUBST_FACTORY</span></span><br><span class="line">       SUBST_FACTORY.clear();</span><br><span class="line">   &#125; <span class="keyword">catch</span> (NoClassDefFoundError ncde) &#123;</span><br><span class="line">       ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String STATIC_LOGGER_BINDER_PATH = <span class="string">"org/slf4j/impl/StaticLoggerBinder.class"</span>;</span><br><span class="line"><span class="function"><span class="keyword">static</span> Set&lt;URL&gt; <span class="title">findPossibleStaticLoggerBinderPathSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   Set&lt;URL&gt; staticLoggerBinderPathSet = <span class="keyword">new</span> LinkedHashSet&lt;URL&gt;();</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">       ClassLoader loggerFactoryClassLoader = LoggerFactory<span class="class">.<span class="keyword">class</span>.<span class="title">getClassLoader</span>()</span>;</span><br><span class="line">       Enumeration&lt;URL&gt; paths;</span><br><span class="line">       <span class="keyword">if</span> (loggerFactoryClassLoader == <span class="keyword">null</span>) &#123;</span><br><span class="line">           paths = ClassLoader.getSystemResources(STATIC_LOGGER_BINDER_PATH);</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       <span class="comment">//è·å–é¡¹ç›®ä¸­æ‰€æœ‰"org/slf4j/impl/StaticLoggerBinder.class"æ–‡ä»¶</span></span><br><span class="line">           paths = loggerFactoryClassLoader.getResources(STATIC_LOGGER_BINDER_PATH);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">while</span> (paths.hasMoreElements()) &#123;</span><br><span class="line">           URL path = paths.nextElement();</span><br><span class="line">           staticLoggerBinderPathSet.add(path);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125; <span class="keyword">catch</span> (IOException ioe) &#123;</span><br><span class="line">       Util.report(<span class="string">"Error getting resources from path"</span>, ioe);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> staticLoggerBinderPathSet;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸SLF4Jç›¸å…³çš„æ¡¥æ¥åŒ…é‡Œéƒ½æœ‰<code>org/slf4j/impl/StaticLoggerBinder</code>ç±»ï¼ŒåŒæ—¶æ‰€æœ‰çš„<code>StaticLoggerBinder</code>éƒ½å®ç°äº†<code>LoggerFactoryBinder</code>æ¥å£ï¼Œæ–¹æ³•<code>getLoggerFactory()</code>ç”¨äºè¿”å›æ¡¥æ¥åŒ…å†…çš„å…·ä½“å·¥å‚å¯¹è±¡(è¿™äº›å·¥å‚å¯¹è±¡éƒ½åœ¨StaticLoggerBinderå¯¹è±¡çš„æ„é€ å‡½æ•°ä¸­è¿›è¡Œäº†åˆå§‹åŒ–)ï¼Œæ¯”å¦‚Log4jLoggerFactoryã€JDK14LoggerFactoryã€JDK14LoggerFactoryâ€¦</p>
<p><img src="/media/log.jpg" alt="log"></p>
<p>SLF4jå®˜æ–¹ç»™å‡ºäº†é€šè¿‡SLF4Jæ¡¥æ¥å…¶ä»–æ—¥å¿—å®ç°æ¡†æ¶æ‰€ä¾èµ–çš„jarã€‚è¿™äº›åŒ…æ–‡ä»¶ä¸­æ— ä¸€ä¾‹å¤–åœ°åŒ…å«ç±»<code>StaticLoggerBinder</code><br><img src="/media/14925649741957.jpg" alt="set up-w888"></p>
<p>æ€»ç»“ï¼š</p>
<ol>
<li>SLF4jæ˜¯é€šè¿‡<code>StaticLoggerBinder</code>æ¥ä¸å…·ä½“æ—¥å¿—å®ç°æ¡†æ¶è¿›è¡Œæ¡¥æ¥çš„ã€‚</li>
<li>å½“SLF4Jæ‰«æåˆ°æœ‰å¤šä¸ª<code>StaticLoggerBinder</code>çš„å®ç°æ—¶ï¼Œä¼šå‘å‡ºæŠ¥è­¦ã€‚åŒæ—¶ä¼šéšæœºé€‰ä¸€ä¸ªã€‚å› æ­¤åº”è¯¥å°½é‡æœç»è¿™ç§æƒ…å†µå‘ç”Ÿã€‚</li>
</ol>
<p>å¦å¤–ï¼ŒSLF4Jä¹Ÿç»™å‡ºäº†åœ¨ä¸šåŠ¡ä»£ç ä¸­ä¹Ÿä½¿ç”¨äº†å…¶ä»–æ—¥å¿—APIçš„æƒ…å†µä¸‹ï¼Œæ¡¥æ¥åˆ°SLF4Jæ‰€ä¾èµ–çš„åŒ…ã€‚<br>å…¶<strong>åŸç†</strong>æ˜¯ï¼šåœ¨è¿™äº›åŒ…å†…éƒ¨(log4j-over-slf4jâ€¦)å®ç°ç›¸åº”æ—¥å¿—APIçš„ç±»ï¼ˆç›¸åŒçš„ç±»åç§°ï¼‰ã€‚æ¯”å¦‚<code>log4j-over-slf4j</code> å®ç°äº†å’Œlog4j1åŒç±»åçš„<code>org.apache.log4j.LogManager</code>ï¼Œè€Œåœ¨<code>log4j-over-slf4j</code>çš„<code>LogManager</code>é‡Œå°±å®ç°äº†æ¡¥æ¥SLF4Jã€‚<br><img src="/media/14925647803336.jpg" alt="set up-w888"></p>
<h3 id="3-è¡¥å……è¯´Log4j2çš„æ¡¥æ¥"><a href="#3-è¡¥å……è¯´Log4j2çš„æ¡¥æ¥" class="headerlink" title="3. è¡¥å……è¯´Log4j2çš„æ¡¥æ¥"></a>3. è¡¥å……è¯´Log4j2çš„æ¡¥æ¥</h3><p>Log4j2çš„ç‰¹æ®Šæ˜¯å› ä¸ºLog4j2åœ¨SLF4jå’ŒCommon-loggingç­‰ä¹‹åè¯ç”Ÿï¼Œè€ŒLog4j2ä¸ºäº†é€‚é…è¿™äº›é€šç”¨æ—¥å¿—æ¥å£ï¼Œä¸å¾—ä¸åšé…åˆå®ƒä»¬çš„é€‚é…å·¥ä½œã€‚<br>ä¸‹å›¾å±•ç¤ºçš„æ˜¯ é€šè¿‡å…¶ä»–æ—¥å¿—æ¥å£æ¡¥æ¥åˆ°æ—¥å¿—å®ç°æ¡†æ¶Log4j2æ‰€éœ€è¦å¼•å…¥çš„ä¾èµ–ã€‚<br><img src="/media/14930140754811.jpg" alt="set up-w580"></p>
<p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼š</p>
<ol>
<li><p>Log4j2ä¸ºäº†æ¡¥æ¥Common-logging æä¾›äº†Log4j-jcl.jarï¼Œèµ„æºæ–‡ä»¶ï¼šMETA-INF/services/org.apache.commons.logging.LogFactoryå†…å®¹:</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.apache.logging.log4j.jcl.LogFactoryImpl</span><br></pre></td></tr></table></figure>
<p> å¯¹åº”çš„å³ä¸º ä¸Šæ–‡ Common-loggingåŒ… getFactory()æ–¹æ³•çš„ç¬¬äºŒæ­¥ã€‚<br> <img src="/media/14931740155318.jpg" alt="set up-w520"></p>
</li>
<li><p>Log4j2ä¸ºäº†æ¡¥æ¥SLF4j ä¹Ÿæä¾›äº†log4j-slf4j-impl.jarã€‚å…¶åŒ…å†…å®¹å¦‚ä¸‹ï¼šæä¾›äº†org.slf4j.impl.StaticLoggerBinder.classï¼›ä»¥èµ·åˆ°æ¡¥æ¥çš„ä½œç”¨ã€‚</p>
<p> <img src="/media/14931744694782.jpg" alt="set up-w520"></p>
</li>
</ol>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç®€åŒ–ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">commons-logging-1.2.jar         X</span><br><span class="line">log4j-1.2.17.jar                X</span><br><span class="line">log4j-1.2-api-2.3.jar           X</span><br><span class="line">log4j-api-2.1.jar          </span><br><span class="line">log4j-core-2.1.jar         </span><br><span class="line">log4j-over-slf4j-1.7.7.jar</span><br><span class="line">jcl-over-slf4j-1.7.7.jar</span><br><span class="line">jul-to-slf4j-1.7.7.jar</span><br><span class="line">log4j-slf4j-impl-2.1.jar</span><br><span class="line">slf4j-api-1.7.7.jar</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/">&lt;i class&#x3D;&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Zamperini</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/%7C%7C%20archive">
                
                    <span class="site-state-item-count">55</span>
                    <span class="site-state-item-name">æ—¥å¿—</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">11</span>
                    <span class="site-state-item-name">åˆ†ç±»</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">22</span>
                    <span class="site-state-item-name">æ ‡ç­¾</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/DorgenJones" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:dblpfilter@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://weibo.com/u/1938368215" target="_blank" title="Weibo">
                      
                        <i class="fa fa-fw fa-weibo"></i>Weibo</a>
                  </span>
                
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zamperini</span>

  

  
</div>




  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Gemini</a> v6.0.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.0.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.0.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.0.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.0.3"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.0.3"></script>



  



	





  





  










  





  

  

  

  

  
  

  

  

  

  

</body>
</html>
